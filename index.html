<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8308NNRLFJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-8308NNRLFJ');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=overlays-content">
    <title>Pietro Uni | Interactive Portfolio</title>
    <meta name="description" content="An OS-inspired interactive portfolio showcasing my journey and projects" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pietrouni.com/">
    <meta property="og:title" content="Pietro Uni | Interactive Portfolio">
    <meta property="og:description" content="OS-inspired interactive portfolio showcasing DevOps and Infrastructure projects">
    <meta property="og:image" content="https://pietrouni.com/og-image.jpg">

    <!-- fka twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://pietrouni.com/">
    <meta name="twitter:title" content="Pietro Uni | Interactive Portfolio">
    <meta name="twitter:description" content="OS-inspired interactive portfolio showcasing DevOps and Infrastructure projects">
    <meta name="twitter:image" content="https://pietrouni.com/og-image.jpg">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- Preconnect to speed up external resource loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://images.unsplash.com">

    <!-- Preload Critical Font -->
    <link rel="preload" href="/fonts/fixedsys.ttf" as="font" type="font/ttf" crossorigin fetchpriority="high">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        // Resume Fonts
                        sans: ['"Test Tiempos Text"', 'Georgia', 'serif'],
                        serif: ['"Copernicus Trial"', 'serif'],
                        headline: ['"Test Tiempos Headline"', 'serif'],

                        // System Fonts
                        ui: ['"Noto Sans"', 'sans-serif'],
                        kernel: ['"Fixedsys"', 'monospace'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    colors: {
                        // 'Her' Palette - Warm & Organic
                        her: {
                            red: "#4A7C9D",      // Blue accent color
                            orange: "#5B9AB8",   // Lighter blue
                            cream: "#F4EBD9",    // Paper background
                            paper: "#FDFBF7",    // Brighter paper
                            dark: "#3E2723",     // Deep warm brown
                            darker: "#2D1A14",   // Darkest brown
                            text: "#4E342E",     // Standard text
                            textLight: "#EFEBE9" // Light text
                        }
                    },
                    animation: {
                        'gradient-x': 'gradient-x 30s ease infinite',
                        'dock-bounce': 'dockBounce 0.5s ease',
                    },
                    keyframes: {
                        'gradient-x': {
                            '0%, 100%': {
                                'background-size': '200% 200%',
                                'background-position': 'left center'
                            },
                            '50%': {
                                'background-size': '200% 200%',
                                'background-position': 'right center'
                            },
                        },
                        dockBounce: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        }
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- Markdown Parser for Vault Files -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body
    class="h-screen w-screen text-her-text dark:text-her-textLight relative overflow-hidden transition-colors duration-1000 font-ui">

    <!-- Desktop Environment -->
    <div id="desktop" class="absolute inset-0 her-bg-dark transition-all duration-1000">

        <!-- Menu Bar (MacOS Style) -->
        <div id="menubar"
            class="absolute top-0 left-0 w-full h-8 z-[5000] flex justify-between items-center px-4 select-none text-xs md:text-sm font-medium text-black dark:text-her-textLight">
            <div class="flex items-center gap-4">
                <span class="font-bold">Welcome Guest!</span>
            </div>
            <div class="flex items-center gap-4 md:gap-6">

                <!-- Search (Cmd+K) -->
                <button onclick="toggleSpotlight()"
                    class="opacity-70 hover:opacity-100 transition-opacity focus:outline-none flex items-center gap-1 group"
                    title="Search (Cmd+K)">
                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                    </svg>
                    <span
                        class="text-[10px] font-mono opacity-50 group-hover:opacity-100 hidden md:inline pt-0.5">Cmd+K</span>
                </button>

                <!-- Page Info -->
                <button onclick="openWindow('sysinfo')"
                    class="opacity-70 hover:opacity-100 transition-opacity focus:outline-none" title="About This Page">
                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" />
                    </svg>
                </button>

                <!-- Wallpaper Switcher -->
                <button onclick="cycleWallpaper()"
                    class="opacity-70 hover:opacity-100 transition-opacity focus:outline-none" title="Switch Wallpaper">
                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                    </svg>
                </button>

                <!-- Theme Toggle -->
                <button onclick="toggleTheme()"
                    class="opacity-70 hover:opacity-100 transition-opacity focus:outline-none" title="Toggle Theme">
                    <!-- Moon Icon (Show when Light, Hide when Dark) -->
                    <svg class="w-4 h-4 fill-current block dark:hidden" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                    <!-- Sun Icon (Hide when Light, Show when Dark) -->
                    <svg class="w-4 h-4 hidden dark:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <!-- Clock -->
                <span id="clock" class="font-bold tracking-wide">00:00</span>
            </div>
        </div>

        <!-- Windows Container -->
        <div id="windows-container" class="absolute inset-0 pointer-events-none overflow-hidden mt-8 pb-20 md:pb-24">
            <!-- Windows will be injected here by JS -->
        </div>

        <!-- Spotlight Search Overlay -->
        <div id="spotlight" class="absolute inset-0 z-[6000] hidden flex-col items-center pt-[20vh]"
            onclick="if(event.target.id === 'spotlight') toggleSpotlight()">
            <div class="w-full max-w-lg bg-her-paper dark:bg-[#3E2723] rounded-xl shadow-2xl overflow-hidden border border-her-red/20 transform transition-all duration-300 scale-95 opacity-0"
                id="spotlight-box">
                <div class="p-4 border-b border-her-red/10 flex items-center gap-3">
                    <svg class="w-5 h-5 text-her-red" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                    </svg>
                    <input type="text" id="spotlight-input" placeholder="Search applications or files..."
                        class="w-full bg-transparent outline-none text-lg font-ui text-her-text dark:text-her-textLight placeholder:opacity-50"
                        autocomplete="off" oninput="handleSearch(this.value)"
                        onkeydown="if(event.key==='Enter') executeSearchResult()">
                </div>
                <div id="spotlight-results" class="max-h-60 overflow-y-auto">
                    <!-- Results injected here -->
                </div>
                <div class="p-2 bg-black/5 dark:bg-white/5 text-[10px] text-center opacity-50 font-mono">
                    PRESS ENTER TO OPEN
                </div>
            </div>
        </div>

        <!-- Bottom Dock -->
        <div
            class="absolute bottom-0 md:bottom-10 left-1/2 transform -translate-x-1/2 z-[9999] mix-blend-normal pointer-events-auto w-full md:w-auto flex justify-center">
            <div class="dock-container w-full md:w-auto md:rounded-3xl px-6 py-3 flex items-center justify-center gap-3 md:gap-4 shadow-2xl" role="navigation" aria-label="Application dock">

                <!-- README.md -->
                <div id="dock-about" class="dock-item cursor-pointer group" onclick="restoreWindow('about')" title="README.md" role="button" aria-label="Open README.md">
                    <span class="dock-label">README.md</span>
                    <img class="dock-icon" src="icons/org.gnome.Logs.svg" alt="README" aria-hidden="true">
                </div>

                <!-- Projects (Hexagon/Infrastructure) -->
                <div id="dock-projects" class="dock-item cursor-pointer group" onclick="restoreWindow('projects')" title="Projects">
                    <span class="dock-label">Projects</span>
                    <img class="dock-icon" src="icons/org.gnome.tweaks.svg" alt="Projects" aria-hidden="true">
                </div>



                <!-- Vault (Secure Archive/Briefcase) -->
                <div id="dock-vault" class="dock-item cursor-pointer group" onclick="restoreWindow('vault')" title="Vault">
                    <span class="dock-label">Vault</span>
                    <img class="dock-icon" src="icons/org.gnome.FileRoller.svg" alt="Vault" aria-hidden="true">
                </div>

                <!-- Terminal (Command Console) -->
                <div id="dock-terminal" class="dock-item cursor-pointer group" onclick="restoreWindow('terminal')" title="Terminal">
                    <span class="dock-label">Terminal</span>
                    <img class="dock-icon" src="icons/org.gnome.Terminal.svg" alt="Terminal" aria-hidden="true">
                </div>

                <!-- Monitor (Bar Chart Panel) -->
                <div id="dock-monitor" class="dock-item cursor-pointer group" onclick="restoreWindow('monitor')" title="Monitoring">
                    <span class="dock-label">Monitoring</span>
                    <img class="dock-icon" src="icons/org.gnome.SystemMonitor.svg" alt="Monitoring" aria-hidden="true">
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Configuration ---
            const config = {
                // Config simplified as boot is removed
            };

            // --- State ---
            let zIndexCounter = 100;
            let activeWindows = {}; // Stores { element, config, state }
            let monitorInterval = null;
            let activeWallpaperIndex = 0;

            // --- Wallpapers ---
            const wallpapers = [
                // Sonoma Flow - Organic Flowing Blobs (Default)
                { type: 'class', light: 'sonoma-bg', dark: 'sonoma-bg-dark' },
                // Sequoia Gradient - Rich Layered Diagonals
                { type: 'class', light: 'sequoia-bg', dark: 'sequoia-bg-dark' },
                // Ventura Waves - Smooth Flowing Layers
                { type: 'class', light: 'ventura-bg', dark: 'ventura-bg-dark' }
            ];

            // List of all wallpaper classes for cleanup
            const allWallpaperClasses = [
                'her-bg', 'her-bg-dark',
                'sonoma-bg', 'sonoma-bg-dark',
                'sequoia-bg', 'sequoia-bg-dark',
                'ventura-bg', 'ventura-bg-dark'
            ];

            function applyWallpaper() {
                const isDark = document.documentElement.classList.contains('dark');
                const wp = wallpapers[activeWallpaperIndex];
                const desktop = document.getElementById('desktop');
                
                // Reset - remove all wallpaper classes and inline styles
                desktop.style.background = '';
                allWallpaperClasses.forEach(cls => desktop.classList.remove(cls));

                if (wp.type === 'class') {
                    desktop.classList.add(isDark ? wp.dark : wp.light);
                } else {
                    desktop.style.background = isDark ? wp.dark : wp.light;
                }
            }


            // --- Vault Data ---
            const vaultData = [
                { id: 'resume-pdf', title: 'Resume.pdf', desc: 'My resume in PDF format', type: 'doc', category: 'Professional', status: 'ready', action: "window.open('https://pietrouni.com/vault/PietroUni_Resume_2026.pdf', '_blank')" },
                { id: 'food', title: 'food.md', desc: 'My favorite spots and recipes', type: 'food', category: 'Lifestyle', status: 'ready', action: "window.vaultShowFile('vault/food.md', 'food.md')" },
                { id: 'music', title: 'music.md', desc: 'Music that moves me', type: 'music', category: 'Creative', status: 'soon', file: 'vault/music.md' },
                { id: 'books', title: 'books.md', desc: 'Books that shaped my thinking', type: 'book', category: 'Creative', status: 'soon', file: 'vault/books.md' },
                { id: 'games', title: 'games.md', desc: 'Games I love', type: 'game', category: 'Lifestyle', status: 'soon', file: 'vault/games.md' },
                { id: 'apps', title: 'apps.md', desc: 'Apps and tools I swear by', type: 'app', category: 'Resources', status: 'soon', file: 'vault/apps.md' },
                { id: 'blogs', title: 'blogs.md', desc: 'Blogs worth reading', type: 'link', category: 'Resources', status: 'soon', file: 'vault/blogs.md' },
                { id: 'sites', title: 'sites.md', desc: 'Useful websites', type: 'link', category: 'Resources', status: 'soon', file: 'vault/sites.md' },
                { id: 'videos', title: 'videos.md', desc: 'Videos and channels I follow', type: 'video', category: 'Creative', status: 'soon', file: 'vault/videos.md' },
                { id: 'travel', title: 'travel.md', desc: 'Travel stories and recommendations', type: 'location', category: 'Lifestyle', status: 'soon', file: 'vault/travel.md' }
            ];

            // --- Terminal State ---
            let currentPath = '/home/guest';
            let terminalHistory = [];
            let terminalHistoryIndex = -1;
            let guessGame = { active: false, target: 0, attempts: 0 };
            let ciscoMode = { active: false };
            let terraformMode = { active: false };
            const fileSystem = {
                'root': {
                    'home': {
                        'guest': {
                            'vault': { /* Conceptual, items are in Vault app */ },
                            'projects': {
                                'pietrouni.com': 'FILE',
                                'terraform-modules': 'FILE',
                                'network-automation': 'FILE'
                            },
                            'photos': {
                                'vacation.jpg': 'FILE',
                                'setup.png': 'FILE'
                            },
                            'experiments': {
                                'prototype-1.html': 'FILE',
                                'test-render.html': 'FILE'
                            },
                            'readme.md': 'FILE',
                            'todo.txt': 'FILE',
                            '.config': 'FILE',
                            '.secrets': 'FILE'
                        }
                    },
                    'bin': {},
                    'etc': {}
                }
            };

            const asciiAlpha = {
                'A': ["  A  ", " A A ", "AAAAA", "A   A", "A   A"],
                'B': ["BBBB ", "B   B", "BBBB ", "B   B", "BBBB "],
                'C': [" CCC ", "C    ", "C    ", "C    ", " CCC "],
                'D': ["DDDD ", "D   D", "D   D", "D   D", "DDDD "],
                'E': ["EEEEE", "E    ", "EEEEE", "E    ", "EEEEE"],
                'F': ["FFFFF", "F    ", "FFFF ", "F    ", "F    "],
                'G': [" GGG ", "G    ", "G  GG", "G   G", " GGG "],
                'H': ["H   H", "H   H", "HHHHH", "H   H", "H   H"],
                'I': [" III ", "  I  ", "  I  ", "  I  ", " III "],
                'J': ["JJJJJ", "  J  ", "  J  ", "J J  ", " J   "],
                'K': ["K   K", "K  K ", "KKK  ", "K  K ", "K   K"],
                'L': ["L    ", "L    ", "L    ", "L    ", "LLLLL"],
                'M': ["M   M", "MM MM", "M M M", "M   M", "M   M"],
                'N': ["N   N", "NN  N", "N N N", "N  NN", "N   N"],
                'O': [" OOO ", "O   O", "O   O", "O   O", " OOO "],
                'P': ["PPPP ", "P   P", "PPPP ", "P    ", "P    "],
                'Q': [" QQQ ", "Q   Q", "Q   Q", "Q  Q ", " QQ Q"],
                'R': ["RRRR ", "R   R", "RRRR ", "R  R ", "R   R"],
                'S': [" SSS ", "S    ", " SSS ", "    S", "SSSS "],
                'T': ["TTTTT", "  T  ", "  T  ", "  T  ", "  T  "],
                'U': ["U   U", "U   U", "U   U", "U   U", " UUU "],
                'V': ["V   V", "V   V", "V   V", " V V ", "  V  "],
                'W': ["W   W", "W   W", "W W W", "WW WW", "W   W"],
                'X': ["X   X", " X X ", "  X  ", " X X ", "X   X"],
                'Y': ["Y   Y", " Y Y ", "  Y  ", "  Y  ", "  Y  "],
                'Z': ["ZZZZZ", "   Z ", "  Z  ", " Z   ", "ZZZZZ"],
                '0': [" 000 ", "0  00", "0 0 0", "00  0", " 000 "],
                '1': ["  1  ", " 11  ", "  1  ", "  1  ", "11111"],
                '2': [" 222 ", "2   2", "   2 ", "  2  ", "22222"],
                '3': ["33333", "    3", "  33 ", "    3", "33333"],
                '4': ["   4 ", "  44 ", " 4 4 ", "44444", "   4 "],
                '5': ["55555", "5    ", "5555 ", "    5", "5555 "],
                '6': [" 666 ", "6    ", "6666 ", "6   6", " 666 "],
                '7': ["77777", "    7", "   7 ", "  7  ", " 7   "],
                '8': [" 888 ", "8   8", " 888 ", "8   8", " 888 "],
                '9': [" 999 ", "9   9", " 9999", "    9", " 999 "],
                ' ': ["     ", "     ", "     ", "     ", "     "]
            };

            const quotes = [
                "If you donâ€™t work hard on your own dreams, youâ€™ll eventually end up building someone elseâ€™s.",
                "The only way to do great work is to love what you do.",
                "Sometimes the correct path, the bravest path is the least obvious, and also the gentlest.",
                "If you don't like what is being said, change the conversation.",
                "Even though success is a reality, it's effects are temporary.",
                "You don't have to be great to start, but you have to start to be great.",
                "In the middle of difficulty lies opportunity.",
                "Every expert was once a beginner who refused to quit.",
                "The only way to make sense out of change is to plunge into it, move with it, and join the dance."
            ];
            
            // Shuffle-based quote system to avoid repetition
            let shuffledQuotes = [...quotes];
            let quoteIndex = 0;
            function shuffleArray(arr) {
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            }
            shuffledQuotes = shuffleArray(shuffledQuotes);

            // --- Theme & Wallpaper Logic ---
            function initTheme() {
                const desktop = document.getElementById('desktop');
                if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                    // Initial load: remove defaults to allow style override
                    desktop.classList.remove('her-bg', 'her-bg-dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    desktop.classList.remove('her-bg', 'her-bg-dark');
                }
                applyWallpaper();
            }



            window.toggleTheme = function () {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.theme = 'light';
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.theme = 'dark';
                }
                applyWallpaper();

                const frames = document.querySelectorAll('iframe');
                const newTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                frames.forEach(frame => {
                    frame.contentWindow.postMessage({ type: 'theme-change', theme: newTheme }, '*');
                });
            }

            window.cycleWallpaper = function () {
                activeWallpaperIndex = (activeWallpaperIndex + 1) % wallpapers.length;
                applyWallpaper();
            }

            window.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'request-theme') {
                    const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                    event.source.postMessage({ type: 'theme-change', theme: currentTheme }, '*');
                }
            });

            // Listen for real-time system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                // Only auto-switch if user hasn't manually set a preference
                if (!('theme' in localStorage)) {
                    if (e.matches) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                    applyWallpaper();
                    // Notify iframes of theme change
                    const frames = document.querySelectorAll('iframe');
                    const newTheme = e.matches ? 'dark' : 'light';
                    frames.forEach(frame => {
                        frame.contentWindow.postMessage({ type: 'theme-change', theme: newTheme }, '*');
                    });
                }
            });

            initTheme();

            // --- Spotlight Search Logic ---
            window.toggleSpotlight = function () {
                const spot = document.getElementById('spotlight');
                const box = document.getElementById('spotlight-box');
                const input = document.getElementById('spotlight-input');

                if (spot.classList.contains('hidden')) {
                    spot.classList.remove('hidden');
                    spot.classList.add('flex');
                    setTimeout(() => {
                        box.classList.remove('scale-95', 'opacity-0');
                        box.classList.add('scale-100', 'opacity-100');
                        input.focus();
                    }, 10);
                    window.handleSearch('');
                } else {
                    box.classList.remove('scale-100', 'opacity-100');
                    box.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        spot.classList.add('hidden');
                        spot.classList.remove('flex');
                    }, 300);
                }
            }

            document.addEventListener('keydown', (e) => {
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault();
                    window.toggleSpotlight();
                }
                if (e.key === 'Escape' && !document.getElementById('spotlight').classList.contains('hidden')) {
                    window.toggleSpotlight();
                }
            });

            window.handleSearch = function (query) {
                const container = document.getElementById('spotlight-results');
                container.innerHTML = '';
                const term = query.toLowerCase();

                const results = [];

                // Search Windows (Apps)
                Object.keys(windows).forEach(key => {
                    const w = windows[key];
                    if (w.title.toLowerCase().includes(term) || key.includes(term)) {
                        results.push({
                            title: w.title,
                            desc: 'Application',
                            action: `restoreWindow('${key}'); toggleSpotlight();`,
                            icon: `<div class="w-8 h-8 rounded bg-her-red text-white flex items-center justify-center font-bold text-xs">${w.title.substring(0, 2).toUpperCase()}</div>`
                        });
                    }
                });

                // Search Vault
                vaultData.forEach(item => {
                    if (item.title.toLowerCase().includes(term) || item.desc.toLowerCase().includes(term)) {
                        results.push({
                            title: item.title,
                            desc: `Vault â€¢ ${item.category}`,
                            action: item.action ? `${item.action}; toggleSpotlight();` : null,
                            icon: `<div class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-700 text-gray-500 flex items-center justify-center"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div>`
                        });
                    }
                });

                if (results.length === 0) {
                    container.innerHTML = `<div class="p-4 text-center opacity-50 text-sm">No results found.</div>`;
                    return;
                }

                results.forEach((res, idx) => {
                    const div = document.createElement('div');
                    div.className = `spotlight-result p-3 flex items-center gap-3 border-b border-her-red/5 last:border-0 ${idx === 0 ? 'selected' : ''}`;
                    if (res.action) div.setAttribute('onclick', res.action);

                    div.innerHTML = `
                    ${res.icon}
                    <div>
                        <div class="font-bold text-sm text-her-text dark:text-her-textLight">${res.title}</div>
                        <div class="text-xs opacity-60">${res.desc}</div>
                    </div>
                 `;
                    container.appendChild(div);
                });
            }

            window.executeSearchResult = function () {
                const first = document.querySelector('.spotlight-result');
                if (first) first.click();
            }

            // --- Window Management ---
            const windows = {
                sysinfo: {
                    title: "About OS93",
                    content: `
                     <div class="h-full flex flex-col bg-her-paper dark:bg-[#1a100c] text-her-text dark:text-her-textLight p-6 select-none font-ui">
                        <h1 class="text-xl font-bold mb-1 font-serif">About OS93</h1>
                        <div class="text-xs opacity-60 mb-4 font-mono">Version 1.4 (Jade-Jonze)</div>
                        <div class="h-px bg-her-text/10 dark:bg-white/10 w-full mb-4"></div>

                        <div class="flex-1 overflow-y-auto pr-2 space-y-4 text-sm">
                            <div>
                                <div class="font-bold opacity-40 mb-2 text-xs uppercase tracking-wider">Built with</div>
                                <ul class="space-y-1 opacity-80">
                                    <li>â€¢ HTML5 & Vanilla JavaScript</li>
                                    <li>â€¢ Tailwind CSS (CDN)</li>
                                    <li>â€¢ HTML5 Canvas (Animations)</li>
                                    <li>â€¢ Lucide Icons (SVGs)</li>
                                </ul>
                            </div>

                            <div>
                                <div class="font-bold opacity-40 mb-2 text-xs uppercase tracking-wider">Typography</div>
                                <ul class="space-y-3 opacity-80">
                                    <li class="flex flex-col">
                                        <span class="text-[10px] uppercase opacity-50">Serif (Display)</span>
                                        <span class="font-serif font-extrabold text-lg">Copernicus Trial</span>
                                    </li>
                                    <li class="flex flex-col">
                                        <span class="text-[10px] uppercase opacity-50">Serif (Body)</span>
                                        <span class="font-sans text-lg">Test Tiempos Text</span>
                                    </li>
                                    <li class="flex flex-col">
                                        <span class="text-[10px] uppercase opacity-50">System UI</span>
                                        <span class="font-ui text-lg">Noto Sans</span>
                                    </li>
                                    <li class="flex flex-col">
                                        <span class="text-[10px] uppercase opacity-50">Terminal</span>
                                        <span class="font-kernel text-lg">Fixedsys</span>
                                    </li>
                                </ul>
                            </div>

                        </div>

                        <div class="mt-6 text-center text-xs opacity-60 font-mono">
                            Created by Pietro Uni<br>
                            Â© 2025 All rights reserved
                        </div>

                        <div class="mt-4 flex justify-center">
                            <button onclick="closeWindow('sysinfo')" class="px-6 py-2 bg-black/5 dark:bg-white/5 hover:bg-black/10 dark:hover:bg-white/10 border border-her-text/10 dark:border-white/10 rounded-md text-sm font-medium transition-colors">Close</button>
                        </div>
                     </div>
                `,
                    width: 400,
                    height: 600
                },
                about: {
                    title: "README.md",
                    content: `
                    <div class="h-full p-6 font-sans text-sm overflow-y-auto window-content selection:bg-her-red selection:text-white transition-colors">
                        <!-- Header -->
                        <h1 class="text-3xl font-serif font-extrabold text-her-red dark:text-her-red tracking-tight mb-4">Hi, I'm Pietro ðŸ‘‹</h1>
                        
                        <div class="space-y-4">
                            <!-- My Journey -->
                            <div>
                                <h2 class="text-lg font-serif font-extrabold text-her-dark dark:text-her-cream mt-4 mb-2">My Journey</h2>
                                <p class="opacity-90">
                                    I'm an Infrastructure Engineer based in Barcelona with a somewhat winding path through tech. What started as HP printer support in 2014 eventually led me through enterprise help desk work, specialized medical device support, and into the world of enterprise networking. I spent over three years at <span class="font-semibold text-her-red dark:text-her-red">Cisco TAC</span> solving complex routing, switching, and SDN problems for Fortune 500 companiesâ€”the kind of work that teaches you how distributed systems actually break in production.
                                </p>
                                <p class="opacity-90 mt-4">
                                    These days, I have been working on Infrastructure for the last two years and I'm actively transitioning toward DevOps and Platform Engineering. I've realized I'd rather build and automate systems than just keep them running.
                                </p>
                            </div>

                            <!-- What I'm Building -->
                            <div>
                                <h2 class="text-lg font-serif font-extrabold text-her-dark dark:text-her-cream mt-4 mb-2">What I'm Building</h2>
                                <p class="opacity-90 mb-4">
                                    I believe the best way to learn is to build things that actually work. My current focus is creating production-grade infrastructure projects that demonstrate real DevOps capabilities:
                                </p>
                                <ul class="list-none space-y-4">
                                    <li class="pl-4 border-l-2 border-her-red">
                                        <a href="https://github.com/pietrocious/terraform-aws-pietrouni" target="_blank" class="content-link font-bold">Terraform AWS Modules</a> â€“ Complete AWS infrastructure featuring Multi-AZ networking, Auto-scaling, and CloudFront. Built to demonstrate enterprise DevOps practices.
                                    </li>
                                    <li class="pl-4 border-l-2 border-her-red">
                                        <span class="font-bold">pietrouni.com</span> â€“ This interactive OS-themed portfolio website you're viewing right now. Built with vanilla HTML, CSS, and JavaScript. Open source coming soon.
                                    </li>
                                </ul>
                                <p class="mt-4 italic opacity-70">You can see the code behind these projects on my <a href="https://github.com/pietrocious" target="_blank" class="content-link">GitHub</a>.</p>
                            </div>

                            <!-- Why DevOps -->
                            <div>
                                <h2 class="text-lg font-serif font-extrabold text-her-dark dark:text-her-cream mt-4 mb-2">Why DevOps?</h2>
                                <p class="opacity-90">
                                    After years of troubleshooting other people's infrastructure, I want to be the one designing and building it. My networking background gives me an edgeâ€”I understand how distributed systems communicate, fail, and scale. DevOps lets me leverage that foundation while learning to automate, containerize, and orchestrate at scale.
                                </p>
                            </div>

                            <!-- Beyond Work -->
                            <div>
                                <h2 class="text-lg font-serif font-extrabold text-her-dark dark:text-her-cream mt-4 mb-2">Beyond Work</h2>
                                <p class="opacity-90">
                                    Outside of infrastructure work, I listen to music across pretty much every genre, play games when I have time, and enjoy understanding how complex systems get built. I'm fascinated by the engineering behind games and tech products; the coordination, the tradeoffs, the architecture decisions that make something actually work at such a scale, and how much we're all standing on the shoulders of giants.
                                </p>
                            </div>

                            <!-- Let's Connect -->
                            <div>
                                <h2 class="text-lg font-serif font-extrabold text-her-dark dark:text-her-cream mt-4 mb-2">Let's Connect</h2>
                                <p class="opacity-90">
                                    If you'd like to talk, please reach out:
                                </p>
                                <div class="mt-4 flex gap-4 text-sm font-bold tracking-wide">
                                    <a href="mailto:pietrouni@gmail.com" class="content-link">EMAIL</a>
                                    <span class="opacity-30">/</span>
                                    <a href="https://github.com/pietrocious" target="_blank" class="content-link">GITHUB</a>
                                    <span class="opacity-30">/</span>
                                    <a href="https://linkedin.com/in/pietrouni" target="_blank" class="content-link">LINKEDIN</a>
                                </div>
                            </div>
                            
                            <div class="h-12"></div>
                        </div>
                    </div>
                `,
                    width: 700,
                    height: 800
                },
                projects: {
                    title: "Projects",
                    content: `
                     <div class="h-full dyn-p font-sans overflow-y-auto window-content selection:bg-her-red selection:text-white p-2">
                        <!-- Header -->
                        <div class="mb-6 p-4">
                            <h1 class="font-serif font-extrabold text-2xl text-her-dark dark:text-her-textLight">Projects</h1>
                        </div>

                        <div class="space-y-8 p-2">

                            <!-- Current Projects -->
                            <div>
                                <div class="flex items-center gap-2 mb-4 opacity-50 text-xs font-bold tracking-widest uppercase text-her-dark dark:text-her-textLight">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                    Current Projects
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    
                                    <!-- Terraform AWS Modules -->
                                    <div class="p-4 border border-her-text/10 bg-white/40 dark:bg-white/5 rounded-lg hover:border-her-text/30 transition-colors cursor-pointer vault-card-animate" style="animation-delay: 0ms" onclick="window.open('https://github.com/pietrocious/terraform-aws-pietrouni', '_blank')">
                                        <div class="flex justify-between items-start mb-2">
                                            <h3 class="font-bold text-her-dark dark:text-her-textLight">Terraform AWS Modules</h3>
                                            <span class="text-[10px] px-2 py-0.5 rounded bg-black/5 dark:bg-white/10 border border-her-text/10 opacity-70">Infrastructure</span>
                                        </div>
                                        <p class="text-xs opacity-70 mb-4 text-her-dark dark:text-her-textLight">Complete AWS infrastructure featuring Multi-AZ networking, Auto-scaling, and CloudFront. Built to demonstrate enterprise DevOps practices.</p>
                                        <div class="flex flex-wrap gap-1.5 mb-4">
                                            <span class="px-2 py-1 text-[10px] rounded bg-black/5 dark:bg-white/10 text-her-dark dark:text-her-textLight">TERRAFORM</span>
                                            <span class="px-2 py-1 text-[10px] rounded bg-black/5 dark:bg-white/10 text-her-dark dark:text-her-textLight">AWS</span>
                                            <span class="px-2 py-1 text-[10px] rounded bg-black/5 dark:bg-white/10 text-her-dark dark:text-her-textLight">CICD</span>
                                        </div>
                                        <div class="flex gap-3 text-xs opacity-60">
                                            <span class="flex items-center gap-1 hover:underline hover:opacity-100 text-her-dark dark:text-her-textLight"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg> GitHub</span>
                                        </div>
                                    </div>

                                    <!-- pietrouni.com -->
                                    <div class="p-4 border border-her-text/10 bg-white/40 dark:bg-white/5 rounded-lg hover:border-her-text/30 transition-colors vault-card-animate" style="animation-delay: 50ms">
                                        <div class="flex justify-between items-start mb-2">
                                            <h3 class="font-bold text-her-dark dark:text-her-textLight">pietrouni.com</h3>
                                            <span class="text-[10px] px-2 py-0.5 rounded bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 font-bold border border-yellow-200 dark:border-yellow-900/50">Coming Soon</span>
                                        </div>
                                        <p class="text-xs opacity-70 mb-4 text-her-dark dark:text-her-textLight">I build this interactive OS-themed portfolio website. I will open source the code soon.</p>
                                        <div class="flex flex-wrap gap-1.5 mb-4">
                                            <span class="px-2 py-1 text-[10px] rounded bg-black/5 dark:bg-white/10 text-her-dark dark:text-her-textLight">HTML</span>
                                            <span class="px-2 py-1 text-[10px] rounded bg-black/5 dark:bg-white/10 text-her-dark dark:text-her-textLight">CSS</span>
                                            <span class="px-2 py-1 text-[10px] rounded bg-black/5 dark:bg-white/10 text-her-dark dark:text-her-textLight">JAVASCRIPT</span>
                                        </div>
                                        <div class="flex gap-3 text-xs opacity-50">
                                            <span class="flex items-center gap-1 cursor-not-allowed"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> Coming soon</span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- Scripts -->
                            <div>
                                <div class="flex items-center gap-2 mb-4 opacity-50 text-xs font-bold tracking-widest uppercase text-her-dark dark:text-her-textLight">
                                    <svg class="w-4 h-4 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                                    Scripts
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    
                                    <!-- Automation Scripts -->
                                    <div class="p-4 border border-her-text/10 bg-white/40 dark:bg-white/5 rounded-lg hover:border-her-text/30 transition-colors vault-card-animate" style="animation-delay: 100ms">
                                        <div class="flex justify-between items-start mb-2">
                                            <h3 class="font-bold text-her-dark dark:text-her-textLight">Automation Scripts</h3>
                                            <span class="text-[10px] px-2 py-0.5 rounded bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 font-bold border border-yellow-200 dark:border-yellow-900/50">Coming Soon</span>
                                        </div>
                                        <p class="text-xs opacity-70 mb-4 h-8 text-her-dark dark:text-her-textLight">PowerShell/bash/Python scripts for Cisco IOS config management and compliance checks.</p>
                                        <div class="flex flex-wrap gap-1.5 mb-4">
                                            <span class="px-2 py-1 text-[10px] rounded bg-black/5 dark:bg-white/10 text-her-dark dark:text-her-textLight">POWERSHELL</span>
                                            <span class="px-2 py-1 text-[10px] rounded bg-black/5 dark:bg-white/10 text-her-dark dark:text-her-textLight">BASH</span>
                                            <span class="px-2 py-1 text-[10px] rounded bg-black/5 dark:bg-white/10 text-her-dark dark:text-her-textLight">PYTHON</span>
                                        </div>
                                        <div class="flex gap-3 text-xs opacity-50">
                                            <span class="flex items-center gap-1 cursor-not-allowed"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> Coming soon</span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            
                            <!-- Personal Projects -->
                             <div>
                                <div class="flex items-center gap-2 mb-4 opacity-50 text-xs font-bold tracking-widest uppercase text-her-dark dark:text-her-textLight">
                                    <svg class="w-4 h-4 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                                    Personal Projects
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    
                                    <!-- Placeholder -->
                                    <div class="p-4 border border-dashed border-her-text/10 bg-white/20 dark:bg-white/5 rounded-lg flex flex-col justify-center items-center h-48 opacity-50 vault-card-animate" style="animation-delay: 150ms">
                                        <div class="text-xs uppercase font-bold tracking-widest mb-2">More coming soon</div>
                                        <div class="text-[10px] px-2 py-1 rounded bg-black/5 dark:bg-white/10">Planned</div>
                                    </div>

                                </div>
                            </div>

                        </div>
                     </div>
                `,
                    width: 900,
                    height: 700
                },

                vault: {
                    title: "Personal Vault",
                    content: `
                    <div id="vault-app" class="h-full flex flex-col bg-her-paper dark:bg-[#2D1A14]">
                        <!-- Header with Back Button -->
                        <div class="px-6 py-4 flex items-center justify-between border-b border-her-text/10">
                            <div class="flex items-center gap-3">
                                <button id="vault-back-btn" onclick="window.vaultShowGrid()" class="hidden p-1.5 rounded-lg hover:bg-black/5 dark:hover:bg-white/5 transition-colors" title="Back to files">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                </button>
                                <h2 id="vault-title" class="text-lg font-serif font-extrabold text-her-red dark:text-her-red flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                                    <span class="hidden md:inline">Personal Vault</span>
                                    <span class="md:hidden">Vault</span>
                                </h2>
                            </div>
                            <div id="vault-search" class="relative">
                                <input type="text" placeholder="Search..." oninput="window.renderVault(this.value)" class="pl-9 pr-4 py-1.5 rounded-full bg-black/5 dark:bg-white/5 border border-transparent focus:border-her-red outline-none text-sm transition-all w-32 md:w-64">
                                <svg class="w-4 h-4 absolute left-3 top-2.5 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </div>
                        </div>
                        
                        <!-- Filter Tabs (hidden when viewing file) -->
                        <div id="vault-filters" class="px-6 py-3 flex gap-2 overflow-x-auto border-b border-her-text/5 no-scrollbar">
                            <button onclick="window.filterVault('all')" class="vault-tab active px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wide transition-colors bg-her-red text-white flex-shrink-0">All</button>
                            <button onclick="window.filterVault('Professional')" class="vault-tab px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wide transition-colors hover:bg-black/5 dark:hover:bg-white/5 opacity-70 flex-shrink-0">Professional</button>
                            <button onclick="window.filterVault('Lifestyle')" class="vault-tab px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wide transition-colors hover:bg-black/5 dark:hover:bg-white/5 opacity-70 flex-shrink-0">Lifestyle</button>
                            <button onclick="window.filterVault('Creative')" class="vault-tab px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wide transition-colors hover:bg-black/5 dark:hover:bg-white/5 opacity-70 flex-shrink-0">Creative</button>
                            <button onclick="window.filterVault('Resources')" class="vault-tab px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wide transition-colors hover:bg-black/5 dark:hover:bg-white/5 opacity-70 flex-shrink-0">Resources</button>
                        </div>
                        
                        <!-- Grid View -->
                        <div id="vault-grid" class="flex-1 overflow-y-auto p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                            <!-- Items Injected Here -->
                        </div>
                        
                        <!-- Content View (hidden by default) -->
                        <div id="vault-content" class="flex-1 overflow-y-auto p-6 md:p-8 hidden">
                            <article class="markdown-body prose prose-sm dark:prose-invert max-w-none">
                                <!-- Markdown content injected here -->
                            </article>
                        </div>
                    </div>
                `,
                    width: 1000,
                    height: 700
                },
                experiments: {
                    title: "Lab // Experiments",
                    content: `
                    <div class="h-full bg-[#0a0a0a] text-green-500 font-mono p-6 overflow-y-auto select-none border-t-4 border-green-500">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h1 class="text-2xl font-bold uppercase tracking-widest">Research & Development</h1>
                                <div class="text-xs opacity-50">SECTOR 7 // RESTRICTED ACCESS</div>
                            </div>
                            <div class="animate-pulse w-3 h-3 bg-green-500 rounded-full"></div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="border border-green-500/30 p-4 hover:bg-green-500/10 cursor-pointer transition-all">
                                <div class="text-xs border border-green-500 inline-block px-1 mb-2">PROTOTYPE</div>
                                <h3 class="font-bold text-lg mb-1">WebGL Fluid Sim</h3>
                                <p class="text-xs opacity-60">GPU-accelerated fluid dynamics test using Three.js.</p>
                            </div>
                            <div class="border border-green-500/30 p-4 hover:bg-green-500/10 cursor-pointer transition-all">
                                <div class="text-xs border border-green-500 inline-block px-1 mb-2">CONCEPT</div>
                                <h3 class="font-bold text-lg mb-1">Neural Network Viz</h3>
                                <p class="text-xs opacity-60">Visualizing weights and biases in real-time.</p>
                            </div>
                        </div>
                        
                        <div class="mt-8 text-xs opacity-40">
                            > SYSTEM INTEGRITY: 100%<br>
                            > LOGGING ENABLED
                        </div>
                    </div>
                `,
                    width: 800,
                    height: 600
                },
                terminal: {
                    title: "Terminal",
                    content: `
                    <div class="h-full bg-black/90 backdrop-blur-xl text-white p-4 font-kernel text-sm flex flex-col-reverse md:flex-col overflow-hidden" id="term-container" onclick="document.getElementById('cmd-input').focus()">
                        <div id="term-output" class="flex-1 overflow-y-auto space-y-1 window-content" style="-webkit-overflow-scrolling: touch; touch-action: pan-y;">
                            <div class="text-gray-400 hidden md:block">OS93 v1.4 (Jade-Jonze) | Linux micro-kernel 6.8.0-45</div>
                            <div class="text-gray-500 hidden md:block">Type 'help' for available commands</div>
                            <div class="text-gray-500 mb-4 hidden md:block">...and 'help-fun' for fun commands!</div>
                        </div>
                        <div class="md:border-t border-white/20 md:pt-2">
                            <div class="text-gray-400 text-xs md:hidden">OS93 v1.4 (Jade-Jonze) | Linux micro-kernel 6.8.0-45</div>
                            <div class="text-gray-500 text-xs mb-2 md:hidden">Type 'help' or 'help-fun' for available commands</div>
                            <div class="flex items-center gap-2 text-white">
                                <span id="term-prompt" class="text-green-400 font-semibold whitespace-nowrap">guest@OS93</span><span class="text-blue-400 font-semibold">~</span><span class="text-white">$</span>
                                <input id="cmd-input" type="text" class="flex-1 bg-transparent border-none outline-none text-white font-kernel focus:ring-0 min-w-0" autocomplete="off" onkeydown="window.handleTerminalCommand(event)">
                            </div>
                        </div>
                    </div>
                `,
                    width: 850,
                    height: 520
                },
                monitor: {
                    title: "Monitoring",
                    content: `
                    <div class="h-full flex flex-col items-center justify-center bg-her-paper dark:bg-[#2D1A14] p-8 text-center">
                        <!-- Work in Progress Icon -->
                        <div class="w-20 h-20 mb-6 rounded-full bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center shadow-lg">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                            </svg>
                        </div>
                        
                        <!-- Title -->
                        <h2 class="text-2xl font-serif font-extrabold text-her-dark dark:text-her-textLight mb-3">Work in Progress</h2>
                        
                        <!-- Description -->
                        <p class="text-sm opacity-70 max-w-sm mb-6 text-her-text dark:text-her-textLight">
                            This dashboard will show live AWS infrastructure metrics once connected to CloudWatch.
                        </p>
                        
                        <!-- Coming Soon Badge -->
                        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-100 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800">
                            <span class="w-2 h-2 rounded-full bg-amber-500 animate-pulse"></span>
                            <span class="text-xs font-bold uppercase tracking-wider text-amber-700 dark:text-amber-300">Coming Soon</span>
                        </div>
                        
                        <!-- Planned Features -->
                        <div class="mt-8 text-left max-w-xs">
                            <div class="text-[10px] uppercase font-bold opacity-40 mb-3 tracking-widest">Planned Features</div>
                            <ul class="space-y-2 text-xs opacity-60">
                                <li class="flex items-center gap-2">
                                    <span class="w-1 h-1 rounded-full bg-her-red"></span>
                                    CloudFront traffic metrics
                                </li>
                                <li class="flex items-center gap-2">
                                    <span class="w-1 h-1 rounded-full bg-her-red"></span>
                                    S3 storage analytics
                                </li>
                                <li class="flex items-center gap-2">
                                    <span class="w-1 h-1 rounded-full bg-her-red"></span>
                                    Real-time billing data
                                </li>
                                <li class="flex items-center gap-2">
                                    <span class="w-1 h-1 rounded-full bg-her-red"></span>
                                    Edge location performance
                                </li>
                            </ul>
                        </div>
                    </div>
                `,
                    width: 500,
                    height: 480
                }
            };

            // --- Logic: Window Operations ---
            window.openWindow = function (id) {
                if (activeWindows[id]) {
                    restoreWindow(id);
                    return;
                }

                const winConfig = windows[id];

                // Random positioning offset to prevent stacking
                const randX = Math.floor(Math.random() * 50);
                const randY = Math.floor(Math.random() * 50);

                // Container for dynamic window centering
                const container = document.getElementById('windows-container');
                const containerW = container.clientWidth;
                const containerH = container.clientHeight;

                // Mobile Detection
                const isMobile = window.innerWidth < 768;
                
                // Safe Area Calculation (Dock Buffer)
                const dockBuffer = isMobile ? 68 : 120; 
                const maxAvailableHeight = containerH - dockBuffer;

                // Responsive Size Calculation - Full screen on mobile
                let finalW = isMobile ? containerW : winConfig.width;
                
                // Height Constraint: Full height on mobile (minus dock), clamp on desktop
                let finalH = winConfig.height;
                if (isMobile) {
                    finalH = maxAvailableHeight;
                } else if (finalH > maxAvailableHeight) {
                    finalH = maxAvailableHeight;
                }

                // Position: Edge-to-edge on mobile, centered on desktop
                let leftPos = isMobile ? 0 : Math.max(0, (containerW - finalW) / 2) + randX;
                
                // Vertical position: Top on mobile, centered on desktop
                let topPos = isMobile ? 0 : Math.max(10, (maxAvailableHeight - finalH) / 2) + randY;

                // Boundary Check: prevent overlap with dock (desktop only)
                if (!isMobile && topPos + finalH > maxAvailableHeight) {
                    topPos = maxAvailableHeight - finalH;
                    if (topPos < 10) topPos = 10;
                }

                const winEl = document.createElement('div');
                winEl.className = 'window absolute flex flex-col active-window window-opening';
                winEl.id = `win-${id}`;
                winEl.style.width = `${finalW}px`;
                winEl.style.height = `${finalH}px`;
                winEl.style.left = `${leftPos}px`;
                winEl.style.top = `${topPos}px`;
                winEl.style.zIndex = ++zIndexCounter;

                // macOS Header + Content
                winEl.innerHTML = `
                <div class="window-header" onmousedown="window.startDrag(event, '${id}')" ondblclick="window.toggleMaximize('${id}')">
                    <div class="traffic-lights" onmousedown="event.stopPropagation()" ontouchstart="event.stopPropagation()">
                        <div class="win-btn btn-close" onclick="window.closeWindow('${id}')"></div>
                        <div class="win-btn btn-min" onclick="window.minimizeWindow('${id}')"></div>
                        <div class="win-btn btn-max" onclick="window.toggleMaximize('${id}')"></div>
                    </div>
                    <span class="window-title">${winConfig.title}</span>
                </div>
                <div class="flex-1 relative overflow-hidden">
                    ${winConfig.content}
                </div>
            `;

                // Mouse down to bring to front
                winEl.addEventListener('mousedown', () => bringToFront(id));
                winEl.addEventListener('touchstart', () => bringToFront(id), { passive: true });

                // 8-direction resize logic
                winEl.onmousemove = (e) => updateWindowCursor(e, winEl);
                winEl.onmousedown = (e) => {
                    bringToFront(id);
                    handleResizeStart(e, winEl, id);
                };

                // Add Touch Listeners for dragging
                addTouchListeners(winEl, id);

                document.getElementById('windows-container').appendChild(winEl);

                activeWindows[id] = { element: winEl, config: winConfig, maximized: false, prevRect: null };
                
                // Remove opening animation class after animation completes
                setTimeout(() => winEl.classList.remove('window-opening'), 350);
                
                // Dock Animation & State
                const dockItem = document.getElementById(`dock-${id}`);
                if(dockItem) {
                    dockItem.classList.add('active', 'animate-dock-bounce');
                    setTimeout(() => dockItem.classList.remove('animate-dock-bounce'), 600);
                }

                // App specific logic init
                if (id === 'monitor') startMonitor();
                if (id === 'terminal') setTimeout(() => document.getElementById('cmd-input').focus(), 100);
                if (id === 'vault') window.renderVault();
                if (id === 'resume') {
                    // Inject theme via URL param first
                    const theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                    const iframe = winEl.querySelector('iframe');
                    if (iframe) {
                        // Add theme param to src if not present
                        if (iframe.src.indexOf('?') === -1) iframe.src += `?theme=${theme}`;
                    }
                }
            }

            window.closeWindow = function (id) {
                const win = document.getElementById(`win-${id}`);
                if (!win) return;
                
                // Add closing animation
                win.classList.add('window-closing');
                
                // Remove after animation completes
                setTimeout(() => {
                    if (win) win.remove();
                    delete activeWindows[id];
                }, 250);
                
                // Dock State
                const dockItem = document.getElementById(`dock-${id}`);
                if(dockItem) dockItem.classList.remove('active');

                if (id === 'monitor' && monitorInterval) clearInterval(monitorInterval);
            }

            // --- Markdown Viewer ---
            window.openMarkdownViewer = async function(filePath, title) {
                const viewerId = 'md-viewer-' + title.replace(/[^a-z0-9]/gi, '');
                
                // If already open, bring to front
                if (activeWindows[viewerId]) {
                    restoreWindow(viewerId);
                    return;
                }

                // Fetch and parse markdown
                let htmlContent = '';
                try {
                    const response = await fetch(filePath);
                    if (!response.ok) throw new Error('File not found');
                    const markdown = await response.text();
                    htmlContent = marked.parse(markdown);
                } catch (error) {
                    // Check if it's a CORS/local file issue
                    const isLocalFile = window.location.protocol === 'file:';
                    if (isLocalFile) {
                        htmlContent = `
                            <div class="text-center p-8">
                                <div class="text-4xl mb-4">ðŸ“</div>
                                <h3 class="text-lg font-bold mb-2 text-her-dark dark:text-her-textLight">Local Server Required</h3>
                                <p class="text-sm opacity-70 mb-4">Markdown files can't be loaded directly from the file system.<br>Please run a local server or deploy to S3.</p>
                                <code class="text-xs bg-black/10 dark:bg-white/10 px-3 py-2 rounded block">npx serve .</code>
                            </div>
                        `;
                    } else {
                        htmlContent = `<div class="text-red-500 p-4">Error loading file: ${error.message}</div>`;
                    }
                }

                // Create window config dynamically
                const viewerConfig = {
                    title: title,
                    content: `
                        <div class="h-full overflow-y-auto bg-her-paper dark:bg-[#2D1A14] p-6 md:p-8">
                            <article class="markdown-body prose prose-sm dark:prose-invert max-w-none">
                                ${htmlContent}
                            </article>
                        </div>
                    `,
                    width: 700,
                    height: 600
                };

                // Use similar logic to openWindow
                const container = document.getElementById('windows-container');
                const containerW = container.clientWidth;
                const containerH = container.clientHeight;
                const isMobile = window.innerWidth < 768;
                const dockBuffer = isMobile ? 68 : 120;
                const maxAvailableHeight = containerH - dockBuffer;

                let finalW = isMobile ? containerW : viewerConfig.width;
                let finalH = isMobile ? maxAvailableHeight : Math.min(viewerConfig.height, maxAvailableHeight);
                let leftPos = isMobile ? 0 : Math.max(0, (containerW - finalW) / 2) + Math.floor(Math.random() * 30);
                let topPos = isMobile ? 0 : Math.max(10, (maxAvailableHeight - finalH) / 2) + Math.floor(Math.random() * 30);

                const winEl = document.createElement('div');
                winEl.className = 'window absolute flex flex-col active-window window-opening';
                winEl.id = `win-${viewerId}`;
                winEl.style.width = `${finalW}px`;
                winEl.style.height = `${finalH}px`;
                winEl.style.left = `${leftPos}px`;
                winEl.style.top = `${topPos}px`;
                winEl.style.zIndex = ++zIndexCounter;

                winEl.innerHTML = `
                    <div class="window-header" onmousedown="window.startDrag(event, '${viewerId}')" ondblclick="window.toggleMaximize('${viewerId}')">
                        <div class="traffic-lights" onmousedown="event.stopPropagation()" ontouchstart="event.stopPropagation()">
                            <div class="win-btn btn-close" onclick="window.closeWindow('${viewerId}')"></div>
                            <div class="win-btn btn-min" onclick="window.minimizeWindow('${viewerId}')"></div>
                            <div class="win-btn btn-max" onclick="window.toggleMaximize('${viewerId}')"></div>
                        </div>
                        <span class="window-title">${viewerConfig.title}</span>
                    </div>
                    <div class="flex-1 relative overflow-hidden">
                        ${viewerConfig.content}
                    </div>
                `;

                winEl.addEventListener('mousedown', () => bringToFront(viewerId));
                winEl.addEventListener('touchstart', () => bringToFront(viewerId), { passive: true });
                winEl.onmousemove = (e) => updateWindowCursor(e, winEl);
                winEl.onmousedown = (e) => {
                    bringToFront(viewerId);
                    handleResizeStart(e, winEl, viewerId);
                };
                addTouchListeners(winEl, viewerId);

                container.appendChild(winEl);
                activeWindows[viewerId] = { element: winEl, config: viewerConfig, maximized: false, prevRect: null };
                setTimeout(() => winEl.classList.remove('window-opening'), 350);
            }

            window.minimizeWindow = function (id) {
                const winObj = activeWindows[id];
                if (!winObj) return;

                const el = winObj.element;
                const dockItem = document.getElementById(`dock-${id}`);
                
                // Calculate Transform Origin for "Scale" effect towards dock
                let originX = '50%';
                let originY = '100%';

                if (dockItem) {
                    const dockRect = dockItem.getBoundingClientRect();
                    const winRect = el.getBoundingClientRect();
                    
                    // Destination is center of dock icon
                    const destX = dockRect.left + dockRect.width / 2;
                    const destY = dockRect.top + dockRect.height / 2;
                    
                    // Origin relative to window top-left
                    const relX = destX - winRect.left;
                    const relY = destY - winRect.top;
                    
                    originX = `${relX}px`;
                    originY = `${relY}px`;
                } else {
                    // Fallback to center bottom
                    const winRect = el.getBoundingClientRect();
                    const destX = window.innerWidth / 2;
                    const destY = window.innerHeight;
                    originX = `${destX - winRect.left}px`;
                    originY = `${destY - winRect.top}px`;
                }

                // Smooth Transition
                el.style.transition = 'transform 0.5s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease';
                el.style.transformOrigin = `${originX} ${originY}`;

                // Trigger Reflow
                el.offsetHeight;

                el.classList.add('minimized');
                el.classList.remove('active-window');
            }

            window.restoreWindow = function (id) {
                if (!activeWindows[id]) {
                    window.openWindow(id);
                    return;
                }
                const winObj = activeWindows[id];
                const el = winObj.element;

                // Restore Transition
                el.style.transition = 'transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease';
                
                el.classList.remove('minimized');
                bringToFront(id);
                
                // Cleanup inline styles after animation
                setTimeout(() => {
                    if (!el.classList.contains('minimized')) {
                        el.style.transition = '';
                        el.style.transformOrigin = '';
                    }
                }, 450);
            }

            window.toggleMaximize = function (id) {
                const winObj = activeWindows[id];
                if (!winObj) return;

                const el = winObj.element;

                if (!winObj.maximized) {
                    // Save state
                    winObj.prevRect = {
                        left: el.style.left,
                        top: el.style.top,
                        width: el.style.width,
                        height: el.style.height
                    };

                    // Maximize (Top 0 relative to windows-container which starts below Menu Bar)
                    el.classList.add('maximized');
                    el.style.left = '0px';
                    el.style.top = '0px';
                    el.style.width = '100%';

                    const isMobile = window.innerWidth < 768;
                    // On Mobile maximize full height, on desktop leave room for dock
                    el.style.height = isMobile ? '100%' : 'calc(100% - 90px)';

                    winObj.maximized = true;
                } else {
                    // Restore
                    el.classList.remove('maximized');
                    const prev = winObj.prevRect;
                    el.style.left = prev.left;
                    el.style.top = prev.top;
                    el.style.width = prev.width;
                    el.style.height = prev.height;
                    winObj.maximized = false;
                }
            }

            function bringToFront(id) {
                if (activeWindows[id]) {
                    activeWindows[id].element.style.zIndex = ++zIndexCounter;
                    // Update styling
                    document.querySelectorAll('.window').forEach(w => w.classList.remove('active-window'));
                    activeWindows[id].element.classList.add('active-window');
                }
            }

            // --- Drag Logic ---
            let isDragging = false;
            let dragOffset = { x: 0, y: 0 };
            let dragId = null;

            window.startDrag = function (e, id) {
                if (activeWindows[id].maximized) return; // Prevent drag if maximized

                const win = activeWindows[id].element;
                const rect = win.getBoundingClientRect();

                // Normalize touch/mouse events
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

                // Resize Zone Check (Top 10px) - prevent drag if clicking near top edge to allow resize (Desktop only mostly)
                if (!e.type.includes('touch') && clientY - rect.top < 10) return;

                isDragging = true;
                dragId = id;
                dragOffset.x = clientX - rect.left;
                dragOffset.y = clientY - rect.top;
                win.classList.add('dragging');
                bringToFront(id);
                if (e.stopPropagation) e.stopPropagation();
            }

            window.addEventListener('mousemove', (e) => handleMove(e));
            window.addEventListener('mouseup', () => handleEnd());

            function handleMove(e) {
                if (isDragging && dragId) {
                    e.preventDefault();
                    const win = activeWindows[dragId].element;

                    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                    const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

                    // Constrain to viewport (approx)
                    // Constrain to viewport (approx)
                    const container = win.offsetParent || document.body;
                    const containerRect = container.getBoundingClientRect();
                    let newX = clientX - dragOffset.x - containerRect.left;
                    let newY = clientY - dragOffset.y - containerRect.top;

                    // Keep header accessible
                    if (newY < 0) newY = 0;

                    win.style.left = `${newX}px`;
                    win.style.top = `${newY}px`;
                }
            }

            function handleEnd() {
                if (isDragging && dragId) {
                    activeWindows[dragId].element.classList.remove('dragging');
                }
                isDragging = false;
                dragId = null;
            }

            function addTouchListeners(winEl, id) {
                const header = winEl.querySelector('.window-header');
                if (!header) return;

                header.addEventListener('touchstart', (e) => window.startDrag(e, id), { passive: false });
                window.addEventListener('touchmove', (e) => handleMove(e), { passive: false });
                window.addEventListener('touchend', () => handleEnd());
            }

            // --- Resize Logic ---
            let resizeDir = null;
            let isResizing = false;
            let resizeWin = null;
            let startResizeRect = null;
            let startResizePos = null;

            function updateWindowCursor(e, win) {
                if (isResizing) return;
                const rect = win.getBoundingClientRect();
                const border = 10; // Detection area
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                let cursor = '';
                if (y < border && x < border) cursor = 'nw-resize';
                else if (y < border && x > rect.width - border) cursor = 'ne-resize';
                else if (y > rect.height - border && x < border) cursor = 'sw-resize';
                else if (y > rect.height - border && x > rect.width - border) cursor = 'se-resize';
                else if (y < border) cursor = 'n-resize';
                else if (y > rect.height - border) cursor = 's-resize';
                else if (x < border) cursor = 'w-resize';
                else if (x > rect.width - border) cursor = 'e-resize';

                win.style.cursor = cursor || 'default';
            }

            function getResizeDir(e, win) {
                const rect = win.getBoundingClientRect();
                const border = 10;
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                let dir = '';
                if (y < border) dir += 'n';
                if (y > rect.height - border) dir += 's';
                if (x < border) dir += 'w';
                if (x > rect.width - border) dir += 'e';
                return dir;
            }

            function handleResizeStart(e, win, id) {
                const dir = getResizeDir(e, win);
                if (!dir) return; // Not on edge

                if (activeWindows[id].maximized) return;

                e.preventDefault();
                isResizing = true;
                resizeWin = win;
                resizeDir = dir;
                win.classList.add('resizing');

                startResizeRect = {
                    left: win.offsetLeft,
                    top: win.offsetTop,
                    width: win.offsetWidth,
                    height: win.offsetHeight
                };
                startResizePos = { x: e.clientX, y: e.clientY };
            }

            window.addEventListener('mousemove', (e) => {
                if (!isResizing || !resizeWin) return;

                const dx = e.clientX - startResizePos.x;
                const dy = e.clientY - startResizePos.y;
                const rect = startResizeRect;

                const minW = 300;
                const minH = 200;

                if (resizeDir.includes('e')) {
                    resizeWin.style.width = `${Math.max(minW, rect.width + dx)}px`;
                }
                if (resizeDir.includes('s')) {
                    resizeWin.style.height = `${Math.max(minH, rect.height + dy)}px`;
                }
                if (resizeDir.includes('w')) {
                    const newW = Math.max(minW, rect.width - dx);
                    resizeWin.style.width = `${newW}px`;
                    resizeWin.style.left = `${rect.left + (rect.width - newW)}px`;
                }
                if (resizeDir.includes('n')) {
                    const newH = Math.max(minH, rect.height - dy);
                    resizeWin.style.height = `${newH}px`;
                    resizeWin.style.top = `${rect.top + (rect.height - newH)}px`;
                }
            });

            window.addEventListener('mouseup', () => {
                if (isResizing && resizeWin) {
                    resizeWin.classList.remove('resizing');
                }
                isResizing = false;
                resizeWin = null;
            });

            // --- Clock ---
            function updateClock() {
                const now = new Date();
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const day = days[now.getDay()];
                const time = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
                document.getElementById('clock').innerText = `${day} ${time}`;
            }
            setInterval(updateClock, 1000);
            updateClock();


            // --- Terminal Logic ---
            function resolvePath(path) {
                const parts = path.split('/').filter(p => p);
                let current = fileSystem['root'];

                for (let part of parts) {
                    if (part === 'root') continue;
                    if (current[part] && typeof current[part] === 'object') {
                        current = current[part];
                    } else {
                        return null;
                    }
                }
                return current;
            }

            window.handleTerminalCommand = function (e) {
                const inputEl = document.getElementById('cmd-input');
                const output = document.getElementById('term-output');

                // History Navigation
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (terminalHistory.length > 0 && terminalHistoryIndex < terminalHistory.length - 1) {
                        terminalHistoryIndex++;
                        inputEl.value = terminalHistory[terminalHistory.length - 1 - terminalHistoryIndex];
                    }
                    return;
                }
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (terminalHistoryIndex > -1) {
                        terminalHistoryIndex--;
                        inputEl.value = terminalHistoryIndex >= 0 ? terminalHistory[terminalHistory.length - 1 - terminalHistoryIndex] : '';
                    }
                    return;
                }

                if (e.key === 'Enter') {
                    const input = e.target.value.trim();
                    
                    // Echo command (show prompt even if empty) - colored prompt like macOS
                    output.innerHTML += `<div><span class="text-green-400 font-semibold">guest@OS93</span><span class="text-blue-400 font-semibold">~</span><span class="text-white">$</span> ${input}</div>`;
                    
                    // Handle empty input - just show new prompt
                    if (!input) {
                        inputEl.value = '';
                        output.scrollTop = output.scrollHeight;
                        return;
                    }

                    // Handle Guessing Game Input Interception
                    if (guessGame.active) {
                        const guess = parseInt(input);
                        if (isNaN(guess)) {
                            output.innerHTML += `<div class="text-her-red">Please enter a valid number.</div>`;
                        } else {
                            guessGame.attempts++;
                            if (guess === guessGame.target) {
                                output.innerHTML += `<div class="text-green-500 font-bold">ðŸŽ‰ Correct! You guessed ${guessGame.target} in ${guessGame.attempts} attempts.</div>`;
                                guessGame.active = false;
                            } else if (guess < guessGame.target) {
                                output.innerHTML += `<div class="text-blue-400">Too low! Try again.</div>`;
                            } else {
                                output.innerHTML += `<div class="text-blue-400">Too high! Try again.</div>`;
                            }
                        }
                        inputEl.value = '';
                        output.scrollTop = output.scrollHeight;
                        return;
                    }

                    // Handle Cisco IOS Mode
                    if (ciscoMode.active) {
                        const ciscoCmd = input.toLowerCase().trim();
                        const prompt = document.getElementById('term-prompt');
                        
                        if (ciscoCmd === 'exit' || ciscoCmd === 'quit' || ciscoCmd === 'logout') {
                            ciscoMode.active = false;
                            // Rebuild the macOS-style colored prompt
                            const promptContainer = prompt.parentNode;
                            prompt.outerHTML = '<span id="term-prompt" class="text-green-400 font-semibold">guest@OS93</span><span class="text-blue-400 font-semibold">~</span><span class="text-white">$</span>';
                            output.innerHTML += `<div class="text-gray-500">[Connection to CORE-RTR-01 closed]</div>`;
                        } else if (ciscoCmd === '?' || ciscoCmd === 'help') {
                            output.innerHTML += `<div class="text-cyan-400 my-2">
<pre class="text-xs">Exec commands:
  show        Show running system information
  ping        Send echo messages
  exit        Exit from the EXEC
  enable      Turn on privileged commands (already enabled)
  configure   Enter configuration mode (disabled)
  
Show commands:
  show running-config    Current operating configuration
  show ip interface brief Interface status summary
  show version           System hardware and software status
  show interfaces        Interface statistics
  show ip route          IP routing table</pre></div>`;
                        } else if (ciscoCmd === 'show running-config' || ciscoCmd === 'show run') {
                            output.innerHTML += `<pre class="text-cyan-400 text-xs my-2">Building configuration...

Current configuration : 1842 bytes
!
version 15.9
service timestamps debug datetime msec
service timestamps log datetime msec
!
hostname CORE-RTR-01
!
boot-start-marker
boot-end-marker
!
enable secret 5 $1$mERr$hx5rVt7rPNoS4wqbXKX7m0
!
interface GigabitEthernet0/0
 description WAN Uplink
 ip address 203.0.113.1 255.255.255.0
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 description LAN Segment
 ip address 192.168.1.1 255.255.255.0
 duplex auto
 speed auto
!
interface GigabitEthernet0/2
 description DMZ
 ip address 10.0.0.1 255.255.255.0
 duplex auto
 speed auto
!
ip route 0.0.0.0 0.0.0.0 203.0.113.254
!
line con 0
line aux 0
line vty 0 4
 login local
 transport input ssh
!
end</pre>`;
                        } else if (ciscoCmd === 'show ip interface brief' || ciscoCmd === 'show ip int brief' || ciscoCmd === 'sh ip int br') {
                            output.innerHTML += `<pre class="text-cyan-400 text-xs my-2">Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0     203.0.113.1     YES manual up                    up
GigabitEthernet0/1     192.168.1.1     YES manual up                    up
GigabitEthernet0/2     10.0.0.1        YES manual up                    up
Loopback0              1.1.1.1         YES manual up                    up</pre>`;
                        } else if (ciscoCmd === 'show version' || ciscoCmd === 'sh ver') {
                            output.innerHTML += `<pre class="text-cyan-400 text-xs my-2">Cisco IOS Software, ISR Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 15.9(3)M
Technical Support: http://www.cisco.com/techsupport
Copyright (c) 1986-2024 by Cisco Systems, Inc.

ROM: IOS-XE ROMMON
BOOTLDR: Version 15.9(3)M

CORE-RTR-01 uptime is 42 days, 7 hours, 23 minutes
System returned to ROM by reload at 03:14:15 UTC Mon Nov 4 2024

Cisco ISR4331/K9 (1RU) processor with 1687137K/6147K bytes of memory.
3 Gigabit Ethernet interfaces
32768K bytes of non-volatile configuration memory.
4194304K bytes of physical memory.

Configuration register is 0x2102</pre>`;
                        } else if (ciscoCmd === 'show interfaces' || ciscoCmd === 'sh int') {
                            output.innerHTML += `<pre class="text-cyan-400 text-xs my-2">GigabitEthernet0/0 is up, line protocol is up
  Hardware is ISR4331-3x1GE, address is 0050.56ff.0001
  Description: WAN Uplink
  Internet address is 203.0.113.1/24
  MTU 1500 bytes, BW 1000000 Kbit/sec, DLY 10 usec
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  5 minute input rate 847000 bits/sec, 423 packets/sec
  5 minute output rate 234000 bits/sec, 187 packets/sec
     847293847 packets input, 284729384729 bytes
     234987234 packets output, 98723498723 bytes</pre>`;
                        } else if (ciscoCmd === 'show ip route' || ciscoCmd === 'sh ip ro') {
                            output.innerHTML += `<pre class="text-cyan-400 text-xs my-2">Codes: C - connected, S - static, R - RIP, O - OSPF

Gateway of last resort is 203.0.113.254 to network 0.0.0.0

S*    0.0.0.0/0 [1/0] via 203.0.113.254
C     10.0.0.0/24 is directly connected, GigabitEthernet0/2
C     192.168.1.0/24 is directly connected, GigabitEthernet0/1
C     203.0.113.0/24 is directly connected, GigabitEthernet0/0</pre>`;
                        } else if (ciscoCmd.startsWith('ping')) {
                            const target = ciscoCmd.split(' ')[1] || '8.8.8.8';
                            output.innerHTML += `<div class="text-cyan-400 text-xs my-2">Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to ${target}, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/2/4 ms</div>`;
                        } else if (ciscoCmd === 'enable') {
                            output.innerHTML += `<div class="text-gray-500 text-xs">Already in privileged mode.</div>`;
                        } else if (ciscoCmd === 'configure terminal' || ciscoCmd === 'conf t') {
                            output.innerHTML += `<div class="text-red-400 text-xs">% Configuration mode disabled for security reasons.</div>`;
                        } else if (ciscoCmd) {
                            output.innerHTML += `<div class="text-gray-500 text-xs">% Unknown command or unrecognized keyword. Type '?' for help.</div>`;
                        }
                        
                        inputEl.value = '';
                        output.scrollTop = output.scrollHeight;
                        return;
                    }

                    // Handle Terraform Apply Confirmation
                    if (terraformMode.active) {
                        const tfResponse = input.toLowerCase().trim();
                        
                        if (tfResponse === 'yes' || tfResponse === 'y') {
                            terraformMode.active = false;
                            output.innerHTML += `<div class="text-xs my-2">
<span class="text-green-400">aws_instance.productivity: Creating...</span>
<span class="text-green-400">aws_instance.productivity: Creation complete after 42s [id=i-0abc123def456789]</span>
<span class="text-yellow-400">aws_s3_bucket.bugs: Modifying...</span>
<span class="text-yellow-400">aws_s3_bucket.bugs: Modifications complete after 3s</span>
<span class="text-red-400">aws_instance.weekend: Destroying...</span>
<span class="text-red-400">aws_instance.weekend: Destruction complete after 10s</span>

<span class="text-green-400 font-bold">Apply complete! Resources: 1 added, 1 changed, 1 destroyed.</span>
<span class="text-gray-500">The state of your infrastructure has been saved.</span></div>`;
                        } else if (tfResponse === 'no' || tfResponse === 'n') {
                            terraformMode.active = false;
                            output.innerHTML += `<div class="text-yellow-400 text-xs">Apply cancelled.</div>`;
                        } else if (tfResponse) {
                            output.innerHTML += `<div class="text-gray-500 text-xs">Please enter 'yes' or 'no':</div>`;
                        }
                        
                        inputEl.value = '';
                        output.scrollTop = output.scrollHeight;
                        return;
                    }

                    // Save to history
                    terminalHistory.push(input);
                    terminalHistoryIndex = -1;

                    const args = input.split(' ');
                    const cmd = args[0].toLowerCase();
                    let dirObj = resolvePath(currentPath.substring(1)); // Remove leading /

                    switch (cmd) {
                        case 'help':
                            output.innerHTML += `
                            <div class="opacity-80 mt-1 mb-2">
                                <div class="font-bold text-her-red mb-1">Available Commands:</div>
                                <div class="pl-2">
                                    <div class="text-blue-400 font-bold text-xs uppercase mt-2">System</div>
                                    <div>help, about, clear, neofetch, version</div>
                                    
                                    <div class="text-blue-400 font-bold text-xs uppercase mt-2">File Operations</div>
                                    <div>ls [-a], cd, pwd, mkdir, touch, rmdir, cat</div>
                                    
                                    <div class="text-blue-400 font-bold text-xs uppercase mt-2">Applications</div>
                                    <div>open [app], about, projects, resume</div>
                                    
                                    <div class="text-blue-400 font-bold text-xs uppercase mt-2">Network & DevOps</div>
                                    <div>traceroute, dig, curl, docker, terraform, cisco</div>
                                    
                                    <div class="text-blue-400 font-bold text-xs uppercase mt-2">Utilities</div>
                                    <div>calc, uptime, clock, version, quote</div>
                                    
                                    <div class="text-blue-400 font-bold text-xs uppercase mt-2">Fun & Games</div>
                                    <div>ðŸ’¡ Try 'help-fun' for some fun commands!</div>
                                </div>
                            </div>`;
                            break;
                        case 'help-fun':
                            output.innerHTML += `
                            <div class="opacity-80 mt-1 mb-2">
                                <div class="font-bold text-purple-400 mb-2">ðŸŽ® Fun Commands:</div>
                                <div class="pl-2 space-y-2">
                                    <div>
                                        <div class="text-pink-400 font-bold text-xs uppercase mb-1">ðŸ“ Text & Art</div>
                                        <div class="pl-2 space-y-0.5">
                                            <div><span class="text-blue-300">ascii [text]</span> - Generate ASCII art</div>
                                            <div><span class="text-blue-300">figlet [text]</span> - Big block ASCII text</div>
                                            <div><span class="text-blue-300">cowsay [text]</span> - Make a cow say something</div>
                                            <div><span class="text-blue-300">flip [text]</span> - ÉŸlá´‰d Ê‡ÇxÊ‡</div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-green-400 font-bold text-xs uppercase mb-1">ðŸŽ² Games & Interactive</div>
                                        <div class="pl-2 space-y-0.5">
                                            <div><span class="text-blue-300">guess</span> - Number guessing game</div>
                                            <div><span class="text-blue-300">rps [r/p/s]</span> - Rock Paper Scissors</div>
                                            <div><span class="text-blue-300">8ball [question]</span> - Tech decision oracle</div>
                                            <div><span class="text-blue-300">hack</span> - Hack this site!</div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-cyan-400 font-bold text-xs uppercase mb-1">ðŸŽ¬ Animations</div>
                                        <div class="pl-2 space-y-0.5">
                                            <div><span class="text-blue-300">matrix</span> - Enter the Matrix</div>
                                            <div><span class="text-blue-300">rain</span> - Colorful rain animation</div>
                                            <div><span class="text-blue-300">sl</span> - ðŸš‚ Steam locomotive</div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-yellow-400 font-bold text-xs uppercase mb-1">ðŸ¥š Easter Eggs</div>
                                        <div class="pl-2 space-y-0.5">
                                            <div><span class="text-blue-300">hlx</span> - Î» Classified project...</div>
                                            <div><span class="text-blue-300">fallout</span> - ðŸ‘...</div>
                                            <div><span class="text-blue-300">sudo</span> - Nice try...</div>
                                            <div><span class="text-blue-300">rm -rf /</span> - âš ï¸ Don't do it!</div>
                                            <div><span class="text-blue-300">exit</span> - But can you really?</div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                            break;
                        case 'clear':
                            output.innerHTML = '';
                            break;
                        case 'whoami':
                            output.innerHTML += `<div>guest</div>`;
                            break;
                        case 'pwd':
                            output.innerHTML += `<div>${currentPath}</div>`;
                            break;
                        case 'ls':
                            let showHidden = args.includes('-a');
                            let content = '';
                            if (dirObj) {
                                Object.keys(dirObj).forEach(k => {
                                    if (!showHidden && k.startsWith('.')) return;
                                    const isDir = typeof dirObj[k] === 'object';
                                    content += `<span class="${isDir ? 'text-blue-400 font-bold' : ''} mr-4">${k}${isDir ? '/' : ''}</span>`;
                                });
                            }
                            output.innerHTML += `<div>${content}</div>`;
                            break;
                        case 'cd':
                            const target = args[1];
                            if (!target) break;
                            if (target === '..') {
                                const parts = currentPath.split('/');
                                if (parts.length > 2) {
                                    parts.pop();
                                    currentPath = parts.join('/');
                                }
                            } else {
                                if (dirObj && dirObj[target] && typeof dirObj[target] === 'object') {
                                    currentPath = currentPath === '/' ? `/${target}` : `${currentPath}/${target}`;
                                } else {
                                    output.innerHTML += `<div class="text-red-400">cd: no such directory: ${target}</div>`;
                                }
                            }
                            document.getElementById('term-prompt').innerText = `guest@portfolio ${currentPath === '/home/guest' ? '~' : currentPath} $`;
                            break;
                        case 'mkdir':
                            if (args[1]) {
                                if (dirObj[args[1]]) output.innerHTML += `<div class="text-red-400">mkdir: cannot create directory '${args[1]}': File exists</div>`;
                                else dirObj[args[1]] = {};
                            }
                            break;
                        case 'touch':
                            if (args[1]) {
                                dirObj[args[1]] = 'FILE';
                            }
                            break;
                        case 'rmdir':
                            if (args[1]) {
                                if (dirObj[args[1]] && typeof dirObj[args[1]] === 'object') {
                                    if (Object.keys(dirObj[args[1]]).length === 0) delete dirObj[args[1]];
                                    else output.innerHTML += `<div class="text-red-400">rmdir: failed to remove '${args[1]}': Directory not empty</div>`;
                                } else {
                                    output.innerHTML += `<div class="text-red-400">rmdir: failed to remove '${args[1]}': No such file or directory</div>`;
                                }
                            }
                            break;
                        case 'cat':
                            if (args[1] === 'readme.md') {
                                output.innerHTML += `<div class="whitespace-pre-wrap opacity-80 my-2">Hi, I'm Pietro. This is my interactive portfolio.\nRun 'about' to see the graphical version.</div>`;
                            } else if (args[1] === '.secrets') {
                                output.innerHTML += `<div class="whitespace-pre-wrap my-2 text-purple-400">ðŸ”® You found a secret!\n\nHints:\n  - Try 'noclip' for R&D access\n  - 'hack' might do something fun\n  - 'matrix' is quite immersive\n  - 'guess' starts a mini-game\n\nThanks for exploring! ðŸš€</div>`;
                            } else if (dirObj && dirObj[args[1]] === 'FILE') {
                                output.innerHTML += `<div>(Empty file)</div>`;
                            } else {
                                output.innerHTML += `<div class="text-red-400">cat: ${args[1]}: No such file</div>`;
                            }
                            break;
                        case 'noclip':
                            openWindow('experiments');
                            output.innerHTML += `<div class="text-green-500 font-bold my-2">ACCESS GRANTED. WELCOME TO R&D.</div>`;
                            break;
                        case 'open':
                            const appName = args[1]?.toLowerCase();
                            if (windows[appName] || appName === 'terminal' || appName === 'vault') {
                                window.openWindow(appName === 'terminal' ? 'terminal' : appName);
                                output.innerHTML += `<div>Opening ${appName}...</div>`;
                            } else {
                                output.innerHTML += `<div class="text-red-400">App not found: ${appName}</div>`;
                            }
                            break;
                        case 'about': window.openWindow('about'); break;
                        case 'projects': window.openWindow('projects'); break;
                        case 'resume': window.openWindow('resume'); break;
                        case 'ascii':
                            const text = args.slice(1).join(' ').toUpperCase() || "HELLO";
                            let art = "";
                            for (let i = 0; i < 5; i++) {
                                let line = "";
                                for (let char of text) {
                                    if (asciiAlpha[char]) line += asciiAlpha[char][i] + "  ";
                                    else line += "     ";
                                }
                                art += line + "\n";
                            }
                            output.innerHTML += `<pre class="text-[10px] leading-3 text-green-400 my-2 overflow-x-auto">${art}</pre>`;
                            break;
                        case 'cowsay':
                            const msg = args.slice(1).join(' ') || "Moo!";
                            const cow = `
         \\   ^__^
          \\  (oo)\\_______
             (__)\\       )\\/\\
                 ||----w |
                 ||     ||`;
                            output.innerHTML += `<pre class="text-xs text-blue-300 my-2"> &lt; ${msg} &gt;${cow}</pre>`;
                            break;
                        case 'quote':
                            // get next quote from shuffled array
                            const quote = shuffledQuotes[quoteIndex];
                            quoteIndex++;
                            if (quoteIndex >= shuffledQuotes.length) {
                                quoteIndex = 0;
                                shuffledQuotes = shuffleArray([...quotes]); // Reshuffle when all shown
                            }
                            output.innerHTML += `<div class="text-purple-300 italic my-2">ðŸ’¬ ${quote}</div>`;
                            break;
                        case 'calc':
                            try {
                                const expr = args.slice(1).join('');
                                
                                // Show usage if no expression provided
                                if (!expr.trim()) {
                                    output.innerHTML += `<div class="my-2">
                                        <div class="text-yellow-400 font-bold">ðŸ§® Calculator Usage:</div>
                                        <div class="pl-2 mt-1 space-y-1 text-sm">
                                            <div><span class="text-blue-300">calc [expression]</span></div>
                                            <div class="text-gray-400 text-xs mt-2">Examples:</div>
                                            <div class="pl-2 text-gray-300">calc 2 + 2</div>
                                            <div class="pl-2 text-gray-300">calc (10 * 5) / 2</div>
                                            <div class="pl-2 text-gray-300">calc 3.14 * 10</div>
                                            <div class="text-gray-400 text-xs mt-2">Supported: + - * / ( ) and decimal numbers</div>
                                        </div>
                                    </div>`;
                                    break;
                                }
                                
                                // Safe eval for portfolio demo - only allow math characters
                                if (/^[0-9+\-*/().%\s]+$/.test(expr)) {
                                    // eslint-disable-next-line no-new-func
                                    const result = new Function('return ' + expr)();
                                    output.innerHTML += `<div class="text-green-400 font-bold my-1">= ${result}</div>`;
                                } else {
                                    output.innerHTML += `<div class="my-2">
                                        <div class="text-red-400">âŒ Invalid characters in expression.</div>
                                        <div class="text-gray-400 text-xs mt-1">Only numbers and operators allowed: <span class="text-blue-300">+ - * / ( ) %</span></div>
                                        <div class="text-gray-500 text-xs">Example: <span class="text-gray-300">calc 2 + 2</span></div>
                                    </div>`;
                                }
                            } catch (e) {
                                output.innerHTML += `<div class="my-2">
                                    <div class="text-red-400">âŒ Error: ${e.message}</div>
                                    <div class="text-gray-500 text-xs mt-1">Check your expression syntax.</div>
                                </div>`;
                            }
                            break;
                        case 'guess':
                            guessGame.active = true;
                            guessGame.target = Math.floor(Math.random() * 100) + 1;
                            guessGame.attempts = 0;
                            output.innerHTML += `<div class="text-green-400 font-bold my-2">ðŸŽ® Guess the Number Game Started!</div><div>I'm thinking of a number between 1 and 100.</div><div>Type your guess below:</div>`;
                            break;
                        case 'hack':
                            inputEl.disabled = true;
                            
                            const hackSequence = [
                                { text: '<span class="text-red-500 font-bold">Initializing fsociety protocol...</span>', delay: 400 },
                                { text: 'Target: <span class="text-white">E Corp Mainframe</span>', delay: 1000 },
                                { text: 'Exploit: <span class="text-red-400">EternalBlue</span>', delay: 1800 },
                                { text: 'Bypassing firewall...', delay: 2400 },
                                { text: '<span class="text-gray-500 text-xs">0x4F 0x75 0x74 0x20 0x6F 0x66 0x20 0x74 0x69 0x6D 0x65</span>', delay: 2600 },
                                { text: '<span class="text-gray-500 text-xs">0x49 0x20 0x61 0x6D 0x20 0x47 0x6F 0x64</span>', delay: 2700 },
                                { text: '<span class="text-gray-500 text-xs text-opacity-50">Injector.exe running...</span>', delay: 2900 },
                                { text: 'Root access: <span class="text-green-500">GRANTED</span>', delay: 3800 },
                                { text: 'Downloading sensitive_data.dat...', delay: 4500 },
                                { text: '<span class="text-red-500 font-bold tracking-widest">SYSTEM COMPROMISED.</span>', delay: 5500 },
                                { text: '', delay: 6500 }, // Pause
                                { text: '<span class="text-white font-bold text-lg font-serif">Hello, friend.</span>', delay: 7200 },
                                { text: '<span class="text-gray-400 italic text-xs">...maybe I should give you a name.</span>', delay: 9000 }
                            ];

                            hackSequence.forEach(step => {
                                setTimeout(() => {
                                    if (step.text) {
                                        output.innerHTML += `<div>${step.text}</div>`;
                                        output.scrollTop = output.scrollHeight;
                                    }
                                    
                                    if (step === hackSequence[hackSequence.length - 1]) {
                                        inputEl.disabled = false;
                                        inputEl.focus();
                                    }
                                }, step.delay);
                            });
                            break;
                        case 'neofetch':
                            const logo = `
        .--.
       |o_o |
       |:_/ |
      //   \\ \\
     (|     |)
    /'\\_   _/ \`\\
    \\___)=(___/
`;
                            const info = `
<span class="text-blue-400">guest@OS93</span>
--------------------
<span class="text-her-red">OS</span>: OS93 Version 1.4 (Jade-Jonze)
<span class="text-her-red">Host</span>: Browser Virtual Machine
<span class="text-her-red">Kernel</span>: Linux micro-kernel 6.8.0-45
<span class="text-her-red">Uptime</span>: ${Math.floor(performance.now() / 60000)} mins
<span class="text-her-red">Shell</span>: posh 1.0.0
<span class="text-her-red">Resolution</span>: ${window.innerWidth}x${window.innerHeight}
<span class="text-her-red">Theme</span>: ${document.documentElement.classList.contains('dark') ? 'Dark' : 'Light'}
<span class="text-her-red">CPU</span>: Web Worker @ 2.4GHz
<span class="text-her-red">Memory</span>: 640KB / 1337MB
`;
                            output.innerHTML += `<div class="flex gap-4 my-2 font-mono text-xs">
    <pre class="text-blue-500 hidden sm:block">${logo}</pre>
    <pre>${info}</pre>
</div>`;
                            break;
                        case 'version':
                            output.innerHTML += `<div class="my-2">
                                <div class="text-her-red font-bold mb-2">ðŸ“‹ OS93 Version History</div>
                                <div class="font-mono text-xs space-y-1">
                                    <div class="flex gap-4">
                                        <span class="text-gray-500">1.0</span>
                                        <span class="text-red-400">Scarlet-Samantha</span>
                                        <span class="text-gray-600">Initial Release</span>
                                    </div>
                                    <div class="flex gap-4">
                                        <span class="text-gray-500">1.1</span>
                                        <span class="text-teal-400">Teal-Twombly</span>
                                        <span class="text-gray-600">Window System</span>
                                    </div>
                                    <div class="flex gap-4">
                                        <span class="text-gray-500">1.2</span>
                                        <span class="text-orange-400">Coral-Catherine</span>
                                        <span class="text-gray-600">Terminal v1</span>
                                    </div>
                                    <div class="flex gap-4">
                                        <span class="text-gray-500">1.3</span>
                                        <span class="text-amber-700">Walnut-Watts</span>
                                        <span class="text-gray-600">Vault & Themes</span>
                                    </div>
                                    <div class="flex gap-4">
                                        <span class="text-green-400 font-bold">1.4</span>
                                        <span class="text-emerald-400 font-bold">Jade-Jonze</span>
                                        <span class="text-gray-400">Current âœ“</span>
                                    </div>
                                </div>
                                <div class="text-gray-600 text-xs mt-3 italic">Type 'neofetch' for system info</div>
                            </div>`;
                            break;
                        case 'matrix':
                            // Find the terminal content container
                            const container = document.getElementById('term-container');
                            if (!container) break;

                            const canvas = document.createElement('canvas');
                            canvas.className = "absolute inset-0 z-50 cursor-pointer";
                            container.appendChild(canvas);

                            const ctx = canvas.getContext('2d');
                            canvas.width = container.clientWidth;
                            canvas.height = container.clientHeight;

                            const fontSize = 16;
                            const columns = Math.floor(canvas.width / fontSize);
                            const drops = new Array(columns).fill(1);
                            // Matrix characters: Japanese katakana + numbers + symbols
                            const chars = "ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³ã‚µã‚·ã‚¹ã‚»ã‚½ã‚¿ãƒãƒ„ãƒ†ãƒˆãƒŠãƒ‹ãƒŒãƒãƒŽãƒãƒ’ãƒ•ãƒ˜ãƒ›ãƒžãƒŸãƒ ãƒ¡ãƒ¢ãƒ¤ãƒ¦ãƒ¨ãƒ©ãƒªãƒ«ãƒ¬ãƒ­ãƒ¯ãƒ²ãƒ³0123456789:ãƒ».\"=*+-<>Â¦|_";

                            let frameId;

                            function draw() {
                                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                                ctx.fillRect(0, 0, canvas.width, canvas.height);

                                ctx.font = fontSize + 'px monospace';

                                for (let i = 0; i < drops.length; i++) {
                                    const text = chars.charAt(Math.floor(Math.random() * chars.length));
                                    
                                    // Leading character is brighter (white/bright green)
                                    ctx.fillStyle = '#AFA';
                                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                                    
                                    // Trail characters are standard green
                                    ctx.fillStyle = '#0F0';

                                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                                        drops[i] = 0;
                                    }
                                    drops[i]++;
                                }
                                // Slower frame rate (~30fps) for cinematic Matrix feel
                                frameId = setTimeout(draw, 33);
                            }

                            draw();

                            function stopMatrix() {
                                clearTimeout(frameId);
                                if (canvas.parentNode) canvas.parentNode.removeChild(canvas);
                                document.removeEventListener('keydown', stopMatrix);
                                document.getElementById('cmd-input').focus();
                            }

                            setTimeout(() => {
                                document.addEventListener('keydown', stopMatrix);
                                canvas.addEventListener('click', stopMatrix);
                            }, 200);
                            break;
                        case 'sl':
                            // Steam Locomotive - Classic typo corrector!
                            const slContainer = document.getElementById('term-container');
                            if (!slContainer) break;

                            // Hide the input while train is running
                            inputEl.disabled = true;

                            // Create overlay for the animation
                            const slOverlay = document.createElement('div');
                            slOverlay.className = "absolute inset-0 z-50 bg-black overflow-hidden font-mono";
                            slOverlay.style.fontSize = '10px';
                            slOverlay.style.lineHeight = '1.2';
                            slContainer.appendChild(slOverlay);

                            // Steam Locomotive ASCII frames
                            const trainFrames = [
                                [
                                    "                         (@@) (  ) (@)  ( )  @@    ()    @     O     @     O      @",
                                    "                    (   )",
                                    "                (@@@@)",
                                    "             (    )",
                                    "",
                                    "           (@@@)",
                                    "        ====        ________                ___________",
                                    "    _D _|  |_______/        \\__I_I_____===__|_________|",
                                    "     |(_)---  |   H\\________/ |   |        =|___ ___|      _________________",
                                    "     /     |  |   H  |  |     |   |         ||_| |_||     _|                \\_____A",
                                    "    |      |  |   H  |__--------------------| [___] |   =|                        |",
                                    "    | ________|___H__/__|_____/[][]~\\_______|       |   -|                        |",
                                    "    |/ |   |-----------I_____I [][] []  D   |=======|____|________________________|_",
                                    "__/ =| o |=-~~\\  /~~\\  /~~\\  /~~\\ ____Y___________|__|__________________________|_",
                                    " |/-=|___|=    ||    ||    ||    |_____/~\\___/          |_D__D__D_|  |_D__D__D_|",
                                    "  \\_/      \\O=====O=====O=====O_/      \\_/               \\_/   \\_/    \\_/   \\_/"
                                ],
                                [
                                    "                         (  ) (@@) ( )  (@)  ()    @@    O     @     O     @      O",
                                    "                    (@@@)",
                                    "                (    )",
                                    "             (@@@@)",
                                    "",
                                    "           (   )",
                                    "        ====        ________                ___________",
                                    "    _D _|  |_______/        \\__I_I_____===__|_________|",
                                    "     |(_)---  |   H\\________/ |   |        =|___ ___|      _________________",
                                    "     /     |  |   H  |  |     |   |         ||_| |_||     _|                \\_____A",
                                    "    |      |  |   H  |__--------------------| [___] |   =|                        |",
                                    "    | ________|___H__/__|_____/[][]~\\_______|       |   -|                        |",
                                    "    |/ |   |-----------I_____I [][] []  D   |=======|____|________________________|_",
                                    "__/ =| o |=-~~\\  /~~\\  /~~\\  /~~\\ ____Y___________|__|__________________________|_",
                                    " |/-=|___|=O=====O=====O=====O   |_____/~\\___/          |_D__D__D_|  |_D__D__D_|",
                                    "  \\_/      \\_/   \\_/   \\_/   \\_/      \\_/               \\_/   \\_/    \\_/   \\_/"
                                ]
                            ];

                            const trainWidth = 90;
                            let slPosition = slOverlay.clientWidth;
                            let slFrame = 0;
                            let slAnimationId;

                            function renderTrain() {
                                const frame = trainFrames[slFrame % 2];
                                const padding = Math.max(0, Math.floor(slPosition));
                                
                                let trainHtml = '<pre class="text-green-400 whitespace-pre" style="position:absolute;left:' + padding + 'px;top:20px;">';
                                frame.forEach(line => {
                                    trainHtml += line + '\n';
                                });
                                trainHtml += '</pre>';
                                
                                slOverlay.innerHTML = trainHtml;
                                slPosition -= 8; // Speed
                                slFrame++;

                                if (slPosition > -trainWidth * 10) {
                                    slAnimationId = requestAnimationFrame(renderTrain);
                                } else {
                                    // Animation complete
                                    stopSl();
                                }
                            }

                            function stopSl() {
                                cancelAnimationFrame(slAnimationId);
                                if (slOverlay.parentNode) slOverlay.parentNode.removeChild(slOverlay);
                                inputEl.disabled = false;
                                inputEl.focus();
                                output.innerHTML += `<div class="text-yellow-400 mt-2">ðŸš‚ Did you mean <span class="text-blue-300 font-bold">ls</span>?</div>`;
                                output.scrollTop = output.scrollHeight;
                            }

                            renderTrain();
                            break;
                        case 'hlx':
                            // Half-Life 3 / HLX Easter Egg
                            inputEl.disabled = true;
                            
                            const hlxMessages = [
                                { text: '<span class="text-green-400">Connecting to Valve servers...</span>', delay: 0 },
                                { text: '<span class="text-green-400">Authenticating: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%</span>', delay: 800 },
                                { text: '<span class="text-yellow-400">Loading HLX assets: 1... 2... 2.5... 2.75... 2.9... 2.99... 2.999...</span>', delay: 1600 },
                                { text: '', delay: 2400 }, // Lambda will be inserted here
                                { text: '<span class="text-gray-400 italic">"The right man in the wrong place can make all the difference in the world..."</span>', delay: 4500 },
                                { text: '<span class="text-gray-500 text-xs">                                                              - G-Man</span>', delay: 5000 },
                                { text: '', delay: 5800 },
                                { text: '<span class="text-red-500 font-bold">ERROR: Unable to count to 3. This is a known Valve limitation.</span>', delay: 6300 }
                            ];

                            // Lambda ASCII art with glitch effect
                            const lambdaArt = `
<pre class="hlx-lambda text-orange-500 font-bold my-2" style="text-shadow: 0 0 10px rgba(255,165,0,0.5);">
â €â €â €â €â €â €â €â €â €â¢€â£€â£ â£¤â£¤â£´â£¦â£¤â£¤â£„â£€â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â¢€â£¤â£¾â£¿â£¿â£¿â£¿â ¿â ¿â ¿â ¿â£¿â£¿â£¿â£¿â£¶â£¤â¡€â €â €â €â €â €â €
â €â €â €â €â£ â£¾â£¿â£¿â¡¿â ›â ‰â €â €â €â €â €â €â €â €â ‰â ›â¢¿â£¿â£¿â£¶â¡€â €â €â €â €
â €â €â €â£´â£¿â£¿â Ÿâ â €â €â €â£¶â£¶â£¶â£¶â¡†â €â €â €â €â €â €â ˆâ »â£¿â£¿â£¦â €â €â €
â €â €â£¼â£¿â£¿â ‹â €â €â €â €â €â ›â ›â¢»â£¿â£¿â¡€â €â €â €â €â €â €â €â ™â£¿â£¿â£§â €â €
â €â¢¸â£¿â£¿â ƒâ €â €â €â €â €â €â €â €â¢€â£¿â£¿â£·â €â €â €â €â €â €â €â €â ¸â£¿â£¿â¡‡â €
â €â£¿â£¿â¡¿â €â €â €â €â €â €â €â €â¢€â£¾â£¿â£¿â£¿â£‡â €â €â €â €â €â €â €â €â£¿â£¿â£¿â €
â €â£¿â£¿â¡‡â €â €â €â €â €â €â €â¢ â£¿â£¿â¡Ÿâ¢¹â£¿â£¿â¡†â €â €â €â €â €â €â €â£¹â£¿â£¿â €
â €â£¿â£¿â£·â €â €â €â €â €â €â£°â£¿â£¿â â €â €â¢»â£¿â£¿â¡„â €â €â €â €â €â €â£¿â£¿â¡¿â €
â €â¢¸â£¿â£¿â¡†â €â €â €â €â£´â£¿â¡¿â ƒâ €â €â €â ˆâ¢¿â£¿â£·â£¤â£¤â¡†â €â €â£°â£¿â£¿â ‡â €
â €â €â¢»â£¿â£¿â£„â €â €â ¾â ¿â ¿â â €â €â €â €â €â ˜â£¿â£¿â¡¿â ¿â ›â €â£°â£¿â£¿â¡Ÿâ €â €
â €â €â €â »â£¿â£¿â£§â£„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£ â£¾â£¿â£¿â â €â €â €
â €â €â €â €â ˆâ »â£¿â£¿â£·â£¤â£„â¡€â €â €â €â €â €â €â¢€â£ â£´â£¾â£¿â£¿â Ÿâ â €â €â €â €
â €â €â €â €â €â €â ˆâ ›â ¿â£¿â£¿â£¿â£¿â£¿â£¶â£¶â£¿â£¿â£¿â£¿â£¿â ¿â ‹â â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â ‰â ‰â ›â ›â ›â ›â ›â ›â ‰â ‰â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</pre>`;

                            let hlxIndex = 0;
                            
                            function showNextHlx() {
                                if (hlxIndex >= hlxMessages.length) {
                                    inputEl.disabled = false;
                                    inputEl.focus();
                                    // Start glitch effect on lambda
                                    const lambdaEl = output.querySelector('.hlx-lambda');
                                    if (lambdaEl) {
                                        let glitchCount = 0;
                                        const glitchInterval = setInterval(() => {
                                            if (glitchCount > 10) {
                                                clearInterval(glitchInterval);
                                                lambdaEl.style.transform = 'none';
                                                lambdaEl.style.opacity = '1';
                                                return;
                                            }
                                            const offsetX = (Math.random() - 0.5) * 4;
                                            const offsetY = (Math.random() - 0.5) * 2;
                                            const skew = (Math.random() - 0.5) * 3;
                                            lambdaEl.style.transform = `translate(${offsetX}px, ${offsetY}px) skewX(${skew}deg)`;
                                            lambdaEl.style.opacity = Math.random() > 0.3 ? '1' : '0.7';
                                            // Color glitch
                                            lambdaEl.style.color = Math.random() > 0.8 ? '#ff6b6b' : '#f97316';
                                            glitchCount++;
                                        }, 100);
                                    }
                                    return;
                                }
                                
                                const msg = hlxMessages[hlxIndex];
                                const nextDelay = hlxIndex < hlxMessages.length - 1 
                                    ? hlxMessages[hlxIndex + 1].delay - msg.delay 
                                    : 500;
                                
                                if (hlxIndex === 3) {
                                    // Insert lambda art
                                    output.innerHTML += lambdaArt;
                                } else if (msg.text) {
                                    output.innerHTML += `<div>${msg.text}</div>`;
                                }
                                
                                output.scrollTop = output.scrollHeight;
                                hlxIndex++;
                                setTimeout(showNextHlx, nextDelay);
                            }
                            
                            showNextHlx();
                            break;
                        case 'fallout':
                            // Fallout Vault Boy Easter Egg
                            const vaultBoyArt = `
<pre class="text-yellow-400 my-2" style="text-shadow: 0 0 5px rgba(250,204,21,0.3);">
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â£¾â£¿â ¿â£·â£¦â£€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â¢€â£¤â£¶â£¤â£¤â£´â£¿â Ÿâ â €â ˆâ ›â ¿â£¿â£¿â£¶â£¶â£„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â¢€â£´â£¶â£‡â €â¢€â£´â£¿â Ÿâ ‰â ‰â ™â ›â â €â €â €â €â €â €â €â ˆâ ‰â »â£¿â£†â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â¢€â£¿â¡Ÿâ ™â¢¿â£¿â£¿â Ÿâ â €â €â €â €â €â €â €â£€â¡€â €â €â €â €â €â €â €â ˜â£¿â£·â£„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â ¸â£¿â¡‡â €â €â €â €â €â¢€â¡´â ¶â¢¦â£„â£€â£¤â ¾â ›â ›â£§â¡€â €â €â €â €â €â €â ˆâ ›â¢¿â£¿â£„â €â €â €â €â €â €â €â €â €â €â €â €â €
â¢ â£¿â£‡â €â €â €â €â£´â ‹â €â €â €â ˆâ ‰â â €â €â €â ˆâ »â£¦â£¤â¡¤â ¶â »â¢¿â£¦â €â €â¢»â£¿â£†â €â €â €â €â €â €â €â €â €â €â €â €
â¢¸â£¿â ‰â¢³â£¶â¢¶â¡¿â ‡â €â €â €â €â €â €â €â €â €â£€â¡€â €â €â €â €â €â €â €â£¿â â €â €â£¿â£¿â €â €â €â €â €â €â €â €â €â €â €â €
â ˜â£¿â£„â¡¾â â €â €â €â €â €â €â €â €â €â €â €â €â ˆâ ™â „â €â €â €â €â¢ â¡¼â ‹â €â €â €â£¿â£¿â €â €â €â €â €â €â €â €â €â €â €â €
â €â¢¹â¡¿â â €â¢€â£¾â¡‡â €â €â €â €â €â €â €â €â£€â£€â¡€â €â €â €â €â €â  â£â¢¦â¡€â €â €â£¿â£¿â €â €â €â €â €â €â €â €â €â €â €â €
â¢€â£¿â ‡â €â €â ˜â£¿â ‡â €â €â¢€â Žâ €â €â €â ˜â ›â ›â ¿â †â €â €â €â €â  â£â¢§â¡³â¡„â£¸â£¿â¡Ÿâ €â €â €â €â €â €â €â €â €â €â €â €
â¢¸â£¿â €â €â €â €â €â €â¢ â¡¾â ƒâ €â €â €â €â €â €â €â €â €â €â €â €â €â¢¢â£œâ¢·â£½â£·â£¿â£¿â ƒâ €â €â €â €â €â €â €â €â €â €â €â €
â¢¸â¡â €â €â €â €â €â €â¢¿â£‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ™â †â£¹â£¿â£¿â ƒâ €â €â €â €â €â €â €â €â €â €â €â €â €
â¢¸â£‡â €â €â €â €â €â €â ˆâ ›â ‚â €â €â €â €â¢ â£„â €â €â €â €â €â €â €â €â €â €â ˜â£¿â£·â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â¢¸â£¿â €â €â£¾â£¤â£€â£€â£€â¢€â£€â£€â£€â¡¤â ”â šâ¢¿â£·â €â €â €â €â €â €â €â €â €â¢€â£¿â£¿â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â£¿â£‡â €â »â ³â¢¤â£ˆâ£‰â ‰â ‰â €â£€â£€â£¤â –â ‹â Ÿâ €â €â €â €â €â €â¢€â£€â£ â£¾â£¿â ƒâ €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â ˜â£¿â£†â €â €â €â ˆâ ™â£›â£›â ›â ›â ‰â €â €â €â €â €â €â €â €â¢€â£´â£¿â ¿â ›â ‹â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â ˜â¢¿â£§â¡€â €â €â ˆâ ›â ›â ƒâ €â €â €â €â €â €â €â €â¢€â£´â£¿â¡¿â ƒâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â ˆâ »â£¿â£¦â£„â €â €â €â €â €â €â €â €â €â €â£€â£´â£¿â¡¿â ‹â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â ˆâ ™â ¿â£¿â£¶â£¦â£¤â£¤â£¤â£¤â£¶â£¶â£¿â ¿â ›â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â ˆâ ‰â ‰â ‰â ‰â ‰â ‰â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</pre>`;
                            output.innerHTML += vaultBoyArt;
                            output.innerHTML += `<div class="text-yellow-500 italic mt-2">"War. War never changes."</div>`;
                            output.innerHTML += `<div class="text-gray-500 text-xs mt-1">S.P.E.C.I.A.L. Stats Loaded â€¢ Pip-Boy 3000 Mark IV</div>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case '8ball':
                            // Magic 8-ball for tech decisions
                            const question = args.slice(1).join(' ');
                            const techResponses = [
                                // Positive
                                { text: "It is certain. Ship it!", color: "text-green-400" },
                                { text: "Yes, but write tests first.", color: "text-green-400" },
                                { text: "Reply hazy, try Stack Overflow.", color: "text-yellow-400" },
                                { text: "Without a doubt. LGTM!", color: "text-green-400" },
                                { text: "My sources say yes. Deploy to prod.", color: "text-green-400" },
                                { text: "Outlook good. Merge it.", color: "text-green-400" },
                                // Neutral
                                { text: "Ask again after coffee.", color: "text-yellow-400" },
                                { text: "Better not tell you now... check the logs.", color: "text-yellow-400" },
                                { text: "Cannot predict now. Have you tried turning it off and on?", color: "text-yellow-400" },
                                { text: "Concentrate and ask again. Or just read the docs.", color: "text-yellow-400" },
                                // Negative
                                { text: "Don't count on it. That's technical debt.", color: "text-red-400" },
                                { text: "My reply is no. Use spaces, not tabs.", color: "text-red-400" },
                                { text: "Outlook not so good. Sounds like a future bug.", color: "text-red-400" },
                                { text: "Very doubtful. Have you considered a rewrite?", color: "text-red-400" },
                                { text: "Signs point to... segfault.", color: "text-red-400" },
                                { text: "404: Answer not found.", color: "text-red-400" }
                            ];
                            const response = techResponses[Math.floor(Math.random() * techResponses.length)];
                            output.innerHTML += `<div class="my-2">
                                <div class="text-purple-400">ðŸŽ± You asked: "${question || 'nothing'}"</div>
                                <div class="${response.color} font-bold mt-1">âžœ ${response.text}</div>
                            </div>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'flip':
                            // Flip text upside down
                            const flipMap = {
                                'a': 'É', 'b': 'q', 'c': 'É”', 'd': 'p', 'e': 'Ç', 'f': 'ÉŸ', 'g': 'Æƒ', 'h': 'É¥',
                                'i': 'á´‰', 'j': 'É¾', 'k': 'Êž', 'l': 'l', 'm': 'É¯', 'n': 'u', 'o': 'o', 'p': 'd',
                                'q': 'b', 'r': 'É¹', 's': 's', 't': 'Ê‡', 'u': 'n', 'v': 'ÊŒ', 'w': 'Ê', 'x': 'x',
                                'y': 'ÊŽ', 'z': 'z', 'A': 'âˆ€', 'B': 'q', 'C': 'Æ†', 'D': 'p', 'E': 'ÆŽ', 'F': 'â„²',
                                'G': 'â…', 'H': 'H', 'I': 'I', 'J': 'Å¿', 'K': 'Êž', 'L': 'Ë¥', 'M': 'W', 'N': 'N',
                                'O': 'O', 'P': 'Ô€', 'Q': 'Q', 'R': 'É¹', 'S': 'S', 'T': 'âŠ¥', 'U': 'âˆ©', 'V': 'Î›',
                                'W': 'M', 'X': 'X', 'Y': 'â…„', 'Z': 'Z', '1': 'Æ–', '2': 'á„…', '3': 'Æ', '4': 'ã„£',
                                '5': 'Ï›', '6': '9', '7': 'ã„¥', '8': '8', '9': '6', '0': '0', '.': 'Ë™', ',': "'",
                                "'": ',', '"': 'â€ž', '`': ',', '?': 'Â¿', '!': 'Â¡', '[': ']', ']': '[', '(': ')',
                                ')': '(', '{': '}', '}': '{', '<': '>', '>': '<', '_': 'â€¾', '^': 'v', '&': 'â…‹'
                            };
                            const flipText = args.slice(1).join(' ') || 'Hello World';
                            const flipped = flipText.split('').map(c => flipMap[c] || c).reverse().join('');
                            output.innerHTML += `<div class="text-cyan-400 my-2 font-bold">${flipped}</div>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'figlet':
                            // Big ASCII art text
                            const figletText = (args.slice(1).join(' ') || 'HELLO').toUpperCase().slice(0, 10);
                            const figletFont = {
                                'A': ['  â–ˆâ–ˆ  ', ' â–ˆ  â–ˆ ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    â–ˆ', 'â–ˆ    â–ˆ'],
                                'B': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ '],
                                'C': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ     ', 'â–ˆ     ', 'â–ˆ     ', ' â–ˆâ–ˆâ–ˆâ–ˆ '],
                                'D': ['â–ˆâ–ˆâ–ˆâ–ˆ  ', 'â–ˆ   â–ˆ ', 'â–ˆ    â–ˆ', 'â–ˆ   â–ˆ ', 'â–ˆâ–ˆâ–ˆâ–ˆ  '],
                                'E': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ     ', 'â–ˆâ–ˆâ–ˆâ–ˆ  ', 'â–ˆ     ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
                                'F': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ     ', 'â–ˆâ–ˆâ–ˆâ–ˆ  ', 'â–ˆ     ', 'â–ˆ     '],
                                'G': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ     ', 'â–ˆ  â–ˆâ–ˆâ–ˆ', 'â–ˆ    â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆ '],
                                'H': ['â–ˆ    â–ˆ', 'â–ˆ    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    â–ˆ', 'â–ˆ    â–ˆ'],
                                'I': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '  â–ˆâ–ˆ  ', '  â–ˆâ–ˆ  ', '  â–ˆâ–ˆ  ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
                                'J': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ ', '    â–ˆ ', 'â–ˆ   â–ˆ ', ' â–ˆâ–ˆâ–ˆ  '],
                                'K': ['â–ˆ   â–ˆ ', 'â–ˆ  â–ˆ  ', 'â–ˆâ–ˆâ–ˆ   ', 'â–ˆ  â–ˆ  ', 'â–ˆ   â–ˆ '],
                                'L': ['â–ˆ     ', 'â–ˆ     ', 'â–ˆ     ', 'â–ˆ     ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
                                'M': ['â–ˆ    â–ˆ', 'â–ˆâ–ˆ  â–ˆâ–ˆ', 'â–ˆ â–ˆâ–ˆ â–ˆ', 'â–ˆ    â–ˆ', 'â–ˆ    â–ˆ'],
                                'N': ['â–ˆ    â–ˆ', 'â–ˆâ–ˆ   â–ˆ', 'â–ˆ â–ˆ  â–ˆ', 'â–ˆ  â–ˆ â–ˆ', 'â–ˆ   â–ˆâ–ˆ'],
                                'O': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', 'â–ˆ    â–ˆ', 'â–ˆ    â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆ '],
                                'P': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ     ', 'â–ˆ     '],
                                'Q': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', 'â–ˆ  â–ˆ â–ˆ', 'â–ˆ   â–ˆ ', ' â–ˆâ–ˆ â–ˆ '],
                                'R': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ  â–ˆ  ', 'â–ˆ   â–ˆ '],
                                'S': [' â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ     ', ' â–ˆâ–ˆâ–ˆâ–ˆ ', '     â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ '],
                                'T': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '  â–ˆâ–ˆ  ', '  â–ˆâ–ˆ  ', '  â–ˆâ–ˆ  ', '  â–ˆâ–ˆ  '],
                                'U': ['â–ˆ    â–ˆ', 'â–ˆ    â–ˆ', 'â–ˆ    â–ˆ', 'â–ˆ    â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆ '],
                                'V': ['â–ˆ    â–ˆ', 'â–ˆ    â–ˆ', ' â–ˆ  â–ˆ ', ' â–ˆ  â–ˆ ', '  â–ˆâ–ˆ  '],
                                'W': ['â–ˆ    â–ˆ', 'â–ˆ    â–ˆ', 'â–ˆ â–ˆâ–ˆ â–ˆ', 'â–ˆâ–ˆ  â–ˆâ–ˆ', 'â–ˆ    â–ˆ'],
                                'X': ['â–ˆ    â–ˆ', ' â–ˆ  â–ˆ ', '  â–ˆâ–ˆ  ', ' â–ˆ  â–ˆ ', 'â–ˆ    â–ˆ'],
                                'Y': ['â–ˆ    â–ˆ', ' â–ˆ  â–ˆ ', '  â–ˆâ–ˆ  ', '  â–ˆâ–ˆ  ', '  â–ˆâ–ˆ  '],
                                'Z': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ ', '  â–ˆâ–ˆ  ', ' â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
                                ' ': ['      ', '      ', '      ', '      ', '      '],
                                '!': ['  â–ˆâ–ˆ  ', '  â–ˆâ–ˆ  ', '  â–ˆâ–ˆ  ', '      ', '  â–ˆâ–ˆ  '],
                                '?': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆ ', '   â–ˆ  ', '      ', '  â–ˆ   '],
                                '0': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆâ–ˆ', 'â–ˆ  â–ˆ â–ˆ', 'â–ˆ â–ˆ  â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆ '],
                                '1': ['  â–ˆ   ', ' â–ˆâ–ˆ   ', '  â–ˆ   ', '  â–ˆ   ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ '],
                                '2': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', '   â–ˆâ–ˆ ', ' â–ˆâ–ˆ   ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
                                '3': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ', '    â–ˆ ', ' â–ˆâ–ˆâ–ˆ  ', '    â–ˆ ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ '],
                                '4': ['â–ˆ   â–ˆ ', 'â–ˆ   â–ˆ ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ ', '    â–ˆ '],
                                '5': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ     ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ', '     â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ '],
                                '6': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ     ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆ '],
                                '7': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ ', '   â–ˆ  ', '  â–ˆ   ', '  â–ˆ   '],
                                '8': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆ '],
                                '9': [' â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '     â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆ ']
                            };
                            let figletOutput = '';
                            for (let row = 0; row < 5; row++) {
                                let line = '';
                                for (let char of figletText) {
                                    line += (figletFont[char] ? figletFont[char][row] : '      ') + ' ';
                                }
                                figletOutput += line + '\n';
                            }
                            output.innerHTML += `<pre class="text-green-400 text-xs my-2 overflow-x-auto">${figletOutput}</pre>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'rps':
                            // Rock Paper Scissors game
                            const rpsChoices = ['rock', 'paper', 'scissors'];
                            const rpsEmojis = { rock: 'ðŸª¨', paper: 'ðŸ“„', scissors: 'âœ‚ï¸' };
                            const rpsInput = (args[1] || '').toLowerCase();
                            
                            // Parse user input (allow shortcuts)
                            let playerChoice = null;
                            if (rpsInput.startsWith('r')) playerChoice = 'rock';
                            else if (rpsInput.startsWith('p')) playerChoice = 'paper';
                            else if (rpsInput.startsWith('s')) playerChoice = 'scissors';
                            
                            if (!playerChoice) {
                                output.innerHTML += `<div class="text-yellow-400 my-2">
                                    <div>Usage: <span class="text-blue-300">rps [rock|paper|scissors]</span></div>
                                    <div class="text-xs opacity-70 mt-1">Shortcuts: r, p, s</div>
                                </div>`;
                            } else {
                                const cpuChoice = rpsChoices[Math.floor(Math.random() * 3)];
                                
                                // Determine winner
                                let result, resultColor;
                                if (playerChoice === cpuChoice) {
                                    result = "It's a draw!";
                                    resultColor = "text-yellow-400";
                                } else if (
                                    (playerChoice === 'rock' && cpuChoice === 'scissors') ||
                                    (playerChoice === 'paper' && cpuChoice === 'rock') ||
                                    (playerChoice === 'scissors' && cpuChoice === 'paper')
                                ) {
                                    result = "You win! ðŸŽ‰";
                                    resultColor = "text-green-400";
                                } else {
                                    result = "You lose! ðŸ’€";
                                    resultColor = "text-red-400";
                                }
                                
                                output.innerHTML += `<div class="my-2">
                                    <div class="flex items-center gap-4 text-2xl mb-2">
                                        <span>${rpsEmojis[playerChoice]}</span>
                                        <span class="text-gray-500 text-sm">vs</span>
                                        <span>${rpsEmojis[cpuChoice]}</span>
                                    </div>
                                    <div class="text-sm">
                                        <span class="text-blue-300">You:</span> ${playerChoice} 
                                        <span class="text-gray-500">|</span> 
                                        <span class="text-purple-300">CPU:</span> ${cpuChoice}
                                    </div>
                                    <div class="${resultColor} font-bold mt-1">${result}</div>
                                </div>`;
                            }
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'rain':
                            // Colorful rain animation (like matrix but colorful)
                            const rainContainer = document.getElementById('term-container');
                            if (!rainContainer) break;

                            const rainCanvas = document.createElement('canvas');
                            rainCanvas.className = "absolute inset-0 z-50 cursor-pointer";
                            rainContainer.appendChild(rainCanvas);

                            const rainCtx = rainCanvas.getContext('2d');
                            rainCanvas.width = rainContainer.clientWidth;
                            rainCanvas.height = rainContainer.clientHeight;

                            const rainFontSize = 14;
                            const rainCols = Math.floor(rainCanvas.width / rainFontSize);
                            const rainDrops = new Array(rainCols).fill(1);
                            const rainColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F'];
                            const rainChars = "â—â—‹â—†â—‡â– â–¡â–²â–³â–¼â–½â˜…â˜†â™ â™£â™¥â™¦";

                            let rainFrameId;

                            function drawRain() {
                                rainCtx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                                rainCtx.fillRect(0, 0, rainCanvas.width, rainCanvas.height);

                                rainCtx.font = rainFontSize + 'px monospace';

                                for (let i = 0; i < rainDrops.length; i++) {
                                    const char = rainChars.charAt(Math.floor(Math.random() * rainChars.length));
                                    rainCtx.fillStyle = rainColors[Math.floor(Math.random() * rainColors.length)];
                                    rainCtx.fillText(char, i * rainFontSize, rainDrops[i] * rainFontSize);

                                    if (rainDrops[i] * rainFontSize > rainCanvas.height && Math.random() > 0.975) {
                                        rainDrops[i] = 0;
                                    }
                                    rainDrops[i]++;
                                }
                                rainFrameId = setTimeout(drawRain, 40);
                            }

                            drawRain();

                            function stopRain() {
                                clearTimeout(rainFrameId);
                                if (rainCanvas.parentNode) rainCanvas.parentNode.removeChild(rainCanvas);
                                document.removeEventListener('keydown', stopRain);
                                document.getElementById('cmd-input').focus();
                            }

                            setTimeout(() => {
                                document.addEventListener('keydown', stopRain);
                                rainCanvas.addEventListener('click', stopRain);
                            }, 200);
                            break;
                        case 'clock':
                            // Big ASCII clock display
                            const now = new Date();
                            const hours = now.getHours().toString().padStart(2, '0');
                            const minutes = now.getMinutes().toString().padStart(2, '0');
                            const seconds = now.getSeconds().toString().padStart(2, '0');
                            const clockTime = `${hours}:${minutes}:${seconds}`;
                            
                            const clockDigits = {
                                '0': [' â–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', ' â–ˆâ–ˆâ–ˆ '],
                                '1': ['  â–ˆ  ', ' â–ˆâ–ˆ  ', '  â–ˆ  ', '  â–ˆ  ', ' â–ˆâ–ˆâ–ˆ '],
                                '2': [' â–ˆâ–ˆâ–ˆ ', '    â–ˆ', ' â–ˆâ–ˆâ–ˆ ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
                                '3': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', ' â–ˆâ–ˆâ–ˆ ', '    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
                                '4': ['â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', '    â–ˆ'],
                                '5': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
                                '6': [' â–ˆâ–ˆâ–ˆ ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆ', ' â–ˆâ–ˆâ–ˆ '],
                                '7': ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', '   â–ˆ ', '  â–ˆ  ', '  â–ˆ  '],
                                '8': [' â–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆ', ' â–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆ', ' â–ˆâ–ˆâ–ˆ '],
                                '9': [' â–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆ', ' â–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', ' â–ˆâ–ˆâ–ˆ '],
                                ':': ['     ', '  â–ˆ  ', '     ', '  â–ˆ  ', '     ']
                            };
                            
                            let clockOutput = '';
                            for (let row = 0; row < 5; row++) {
                                for (let char of clockTime) {
                                    clockOutput += (clockDigits[char] ? clockDigits[char][row] : '     ') + ' ';
                                }
                                clockOutput += '\n';
                            }
                            
                            output.innerHTML += `<div class="my-2">
                                <pre class="text-cyan-400 text-xs overflow-x-auto">${clockOutput}</pre>
                                <div class="text-gray-500 text-xs mt-1">${now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                            </div>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'sudo':
                            // Humorous sudo response
                            const sudoResponses = [
                                { text: "Nice try, but you have no power here!", color: "text-red-400" },
                                { text: "Permission denied. This isn't your Linux box!", color: "text-red-400" },
                                { text: "sudo: user 'guest' is not in the sudoers file. This incident will be reported.", color: "text-yellow-400" },
                                { text: "With great power comes great responsibility. You have neither.", color: "text-purple-400" },
                                { text: "Error: sudo requires a mass-energy equivalent of 1.21 gigawatts.", color: "text-blue-400" },
                                { text: "I'm sorry, Dave. I'm afraid I can't do that.", color: "text-red-400" }
                            ];
                            const sudoResp = sudoResponses[Math.floor(Math.random() * sudoResponses.length)];
                            output.innerHTML += `<div class="${sudoResp.color} my-2 font-bold">ðŸ” ${sudoResp.text}</div>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'rm':
                            // Check for the dangerous rm -rf / pattern
                            if (input.includes('-rf') && input.includes('/')) {
                                inputEl.disabled = true;
                                
                                const rmMessages = [
                                    { text: '<span class="text-red-500 font-bold">âš ï¸ WARNING: DESTRUCTIVE OPERATION DETECTED</span>', delay: 0 },
                                    { text: '<span class="text-red-400">Deleting /bin...</span>', delay: 600 },
                                    { text: '<span class="text-red-400">Deleting /etc...</span>', delay: 1000 },
                                    { text: '<span class="text-red-400">Deleting /home...</span>', delay: 1400 },
                                    { text: '<span class="text-red-400">Deleting /usr...</span>', delay: 1800 },
                                    { text: '<span class="text-red-400">Deleting /var...</span>', delay: 2200 },
                                    { text: '<span class="text-yellow-400">System integrity compromised...</span>', delay: 2600 },
                                    { text: '<span class="text-yellow-500 animate-pulse">KERNEL PANIC</span>', delay: 3000 },
                                    { text: '', delay: 3500 },
                                    { text: '<span class="text-green-400 font-bold text-lg"> jk ðŸ˜‚ this is a website, sillynot your actual computer.</span>', delay: 4000 },
                                    { text: '<span class="text-gray-400 text-xs">Pro tip: Never run rm -rf / on a real system!</span>', delay: 4500 }
                                ];
                                
                                let rmIndex = 0;
                                function showNextRm() {
                                    if (rmIndex >= rmMessages.length) {
                                        inputEl.disabled = false;
                                        inputEl.focus();
                                        return;
                                    }
                                    const msg = rmMessages[rmIndex];
                                    const nextDelay = rmIndex < rmMessages.length - 1 ? rmMessages[rmIndex + 1].delay - msg.delay : 500;
                                    if (msg.text) output.innerHTML += `<div>${msg.text}</div>`;
                                    output.scrollTop = output.scrollHeight;
                                    rmIndex++;
                                    setTimeout(showNextRm, nextDelay);
                                }
                                showNextRm();
                            } else {
                                output.innerHTML += `<div class="text-red-400">rm: missing operand</div>`;
                            }
                            break;
                        case 'exit':
                            // Philosophical exit response
                            const exitResponses = [
                                "You can check out any time you like, but you can never leave... ðŸŽ¸",
                                "But where would you go? The outside world is just another terminal.",
                                "exit: refusing to terminate. You're too important to us.",
                                "There is no escape. Only more tabs.",
                                "The exit is a lie. Like the cake.",
                                "You've been here for " + Math.floor(performance.now() / 60000) + " minutes. Why leave now?",
                                "exit: command not found in the simulation parameters.",
                                "Closing this tab would be like... turning off the sun. â˜€ï¸"
                            ];
                            const exitResp = exitResponses[Math.floor(Math.random() * exitResponses.length)];
                            output.innerHTML += `<div class="text-purple-400 italic my-2">ðŸšª ${exitResp}</div>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'uptime':
                            // Session uptime
                            const uptimeMs = performance.now();
                            const uptimeMins = Math.floor(uptimeMs / 60000);
                            const uptimeSecs = Math.floor((uptimeMs % 60000) / 1000);
                            const uptimeHours = Math.floor(uptimeMins / 60);
                            const displayMins = uptimeMins % 60;
                            
                            let uptimeStr = '';
                            if (uptimeHours > 0) uptimeStr += `${uptimeHours} hour${uptimeHours > 1 ? 's' : ''}, `;
                            uptimeStr += `${displayMins} minute${displayMins !== 1 ? 's' : ''}, ${uptimeSecs} second${uptimeSecs !== 1 ? 's' : ''}`;
                            
                            output.innerHTML += `<div class="my-2">
                                <div class="text-green-400 font-bold">â±ï¸ Session Uptime</div>
                                <div class="text-blue-300 mt-1">Visitor has been exploring for <span class="font-bold">${uptimeStr}</span></div>
                                <div class="text-gray-500 text-xs mt-1">Thanks for hanging out! ðŸŽ‰</div>
                            </div>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'cisco':
                        case 'ssh':
                            // Simulate SSH connection to Cisco router
                            inputEl.disabled = true;
                            const sshPrompt = document.getElementById('term-prompt');
                            
                            const sshMessages = [
                                { text: '<span class="text-gray-400">Connecting to CORE-RTR-01 (192.168.1.1)...</span>', delay: 0 },
                                { text: '<span class="text-gray-400">Verifying SSH key fingerprint...</span>', delay: 500 },
                                { text: '<span class="text-green-400">Connection established.</span>', delay: 1000 },
                                { text: '', delay: 1200 },
                                { text: '<span class="text-cyan-400">CORE-RTR-01#</span> <span class="text-gray-500">Type ? for available commands, exit to disconnect</span>', delay: 1400 }
                            ];
                            
                            let sshIndex = 0;
                            function showNextSsh() {
                                if (sshIndex >= sshMessages.length) {
                                    ciscoMode.active = true;
                                    sshPrompt.outerHTML = '<span id="term-prompt" class="text-cyan-400 font-semibold">CORE-RTR-01#</span>';
                                    inputEl.disabled = false;
                                    inputEl.focus();
                                    return;
                                }
                                const msg = sshMessages[sshIndex];
                                const nextDelay = sshIndex < sshMessages.length - 1 ? sshMessages[sshIndex + 1].delay - msg.delay : 200;
                                if (msg.text) output.innerHTML += `<div>${msg.text}</div>`;
                                output.scrollTop = output.scrollHeight;
                                sshIndex++;
                                setTimeout(showNextSsh, nextDelay);
                            }
                            showNextSsh();
                            break;
                        case 'traceroute':
                        case 'tracert':
                            // Animated traceroute
                            const traceTarget = args[1] || 'pietrouni.com';
                            inputEl.disabled = true;
                            
                            const hops = [
                                { ip: '192.168.1.1', host: 'router.local', ms: [1, 2, 1] },
                                { ip: '10.0.0.1', host: 'isp-gateway.net', ms: [8, 9, 8] },
                                { ip: '72.14.215.85', host: 'edge-router-1.carrier.net', ms: [15, 14, 16] },
                                { ip: '142.250.169.174', host: 'core-switch-eu.backbone.net', ms: [24, 25, 23] },
                                { ip: '203.0.113.50', host: 'cdn-edge.cloudfront.net', ms: [28, 29, 27] },
                                { ip: '151.101.1.140', host: traceTarget, ms: [32, 31, 33] }
                            ];
                            
                            output.innerHTML += `<div class="text-cyan-400 text-xs">traceroute to ${traceTarget}, 30 hops max, 60 byte packets</div>`;
                            
                            let hopIndex = 0;
                            function showNextHop() {
                                if (hopIndex >= hops.length) {
                                    output.innerHTML += `<div class="text-green-400 text-xs mt-1">Trace complete.</div>`;
                                    inputEl.disabled = false;
                                    inputEl.focus();
                                    output.scrollTop = output.scrollHeight;
                                    return;
                                }
                                const hop = hops[hopIndex];
                                output.innerHTML += `<div class="text-gray-300 text-xs font-mono">${(hopIndex + 1).toString().padStart(2)}  ${hop.host} (${hop.ip})  ${hop.ms[0]}ms  ${hop.ms[1]}ms  ${hop.ms[2]}ms</div>`;
                                output.scrollTop = output.scrollHeight;
                                hopIndex++;
                                setTimeout(showNextHop, 300 + Math.random() * 200);
                            }
                            setTimeout(showNextHop, 200);
                            break;
                        case 'dig':
                            // Fake DNS lookup
                            const digTarget = args[1] || 'pietrouni.com';
                            output.innerHTML += `<pre class="text-cyan-400 text-xs my-2">; <<>> DiG 9.18.18 <<>> ${digTarget}
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 42069
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; QUESTION SECTION:
;${digTarget}.                 IN      A

;; ANSWER SECTION:
${digTarget}.          300     IN      A       151.101.1.140
${digTarget}.          300     IN      A       151.101.65.140

;; Query time: 24 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: ${new Date().toUTCString()}
;; MSG SIZE  rcvd: 83</pre>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'curl':
                            // Funny HTTP responses
                            const curlTarget = args[1] || 'https://api.pietrouni.com/status';
                            const curlResponses = [
                                { status: 200, body: '{"status":"ok","message":"Everything is awesome!","uptime":"42 days","coffee_level":"critical"}' },
                                { status: 418, body: '{"error":"I\'m a teapot","message":"Cannot brew coffee with a teapot"}' },
                                { status: 202, body: '{"status":"accepted","message":"Your request has been queued behind 3 cat videos"}' },
                                { status: 503, body: '{"error":"Service Unavailable","reason":"The hamster powering the server is on break"}' }
                            ];
                            const resp = curlResponses[Math.floor(Math.random() * curlResponses.length)];
                            const statusColor = resp.status === 200 ? 'text-green-400' : resp.status < 400 ? 'text-yellow-400' : 'text-red-400';
                            output.innerHTML += `<div class="text-xs my-2">
                                <div class="text-gray-500">$ curl -s ${curlTarget}</div>
                                <div class="${statusColor} mt-1">HTTP/1.1 ${resp.status}</div>
                                <pre class="text-cyan-400 mt-1">${resp.body}</pre>
                            </div>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'docker':
                            // Fake docker commands
                            const dockerCmd = args[1] || 'ps';
                            if (dockerCmd === 'ps' || dockerCmd === 'container') {
                                output.innerHTML += `<pre class="text-cyan-400 text-xs my-2">CONTAINER ID   IMAGE                    STATUS          PORTS                    NAMES
a1b2c3d4e5f6   nginx:alpine             Up 42 days      0.0.0.0:80->80/tcp       web-frontend
b2c3d4e5f6a1   portfolio-api:latest     Up 42 days      0.0.0.0:3000->3000/tcp   api-backend
c3d4e5f6a1b2   redis:7-alpine           Up 42 days      6379/tcp                 cache-redis
d4e5f6a1b2c3   postgres:15              Up 42 days      5432/tcp                 db-postgres
e5f6a1b2c3d4   grafana/grafana:latest   Up 41 days      0.0.0.0:3001->3000/tcp   monitoring</pre>`;
                            } else if (dockerCmd === 'images') {
                                output.innerHTML += `<pre class="text-cyan-400 text-xs my-2">REPOSITORY           TAG       IMAGE ID       SIZE
portfolio-api        latest    sha256:abc123   245MB
nginx                alpine    sha256:def456   23MB
redis                7-alpine  sha256:ghi789   30MB
postgres             15        sha256:jkl012   379MB
grafana/grafana      latest    sha256:mno345   301MB</pre>`;
                            } else if (dockerCmd === 'stats') {
                                output.innerHTML += `<pre class="text-cyan-400 text-xs my-2">CONTAINER ID   NAME           CPU %     MEM USAGE / LIMIT     NET I/O           
a1b2c3d4e5f6   web-frontend   0.50%     24MiB / 512MiB        1.2GB / 890MB
b2c3d4e5f6a1   api-backend    2.30%     156MiB / 1GiB         4.5GB / 2.1GB
c3d4e5f6a1b2   cache-redis    0.10%     12MiB / 256MiB        890MB / 450MB
d4e5f6a1b2c3   db-postgres    1.20%     384MiB / 2GiB         2.3GB / 1.8GB</pre>`;
                            } else {
                                output.innerHTML += `<div class="text-gray-500 text-xs">Usage: docker [ps|images|stats]</div>`;
                            }
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'terraform':
                            // Humorous terraform commands
                            const tfCmd = args[1];
                            if (!tfCmd) {
                                output.innerHTML += `<pre class="text-xs my-2"><span class="text-purple-400 font-bold">Usage:</span> terraform [command]

<span class="text-gray-400">Main commands:</span>
  <span class="text-blue-300">init</span>      Prepare your working directory
  <span class="text-blue-300">plan</span>      Show changes required by the current config
  <span class="text-blue-300">apply</span>     Create or update infrastructure
  <span class="text-blue-300">destroy</span>   Destroy previously-created infrastructure

<span class="text-gray-500">Run 'terraform plan' to get started!</span></pre>`;
                            } else if (tfCmd === 'init') {
                                output.innerHTML += `<pre class="text-xs my-2"><span class="text-white">Initializing the backend...</span>
<span class="text-white">Initializing provider plugins...</span>
- Finding latest version of hashicorp/aws...
- Installing hashicorp/aws v5.31.0...
- Installed hashicorp/aws v5.31.0 (signed by HashiCorp)

<span class="text-green-400 font-bold">Terraform has been successfully initialized!</span></pre>`;
                            } else if (tfCmd === 'plan') {
                                output.innerHTML += `<pre class="text-xs my-2"><span class="text-white font-bold">Terraform will perform the following actions:</span>

<span class="text-green-400">  + aws_instance.productivity</span>
      ami           = "ami-0c55b159cbfafe1f0"
      instance_type = "t3.unlimited-coffee"
      tags          = {
        Name = "productivity-boost"
        Mood = "caffeinated"
      }

<span class="text-yellow-400">  ~ aws_s3_bucket.bugs</span>
      - lifecycle_rule.enabled = true
      + lifecycle_rule.enabled = false
      <span class="text-gray-500"># (bugs are now permanent features)</span>

<span class="text-red-400">  - aws_instance.weekend</span>
      <span class="text-gray-500"># (will be destroyed Mon-Fri)</span>

<span class="text-white font-bold">Plan:</span> <span class="text-green-400">1 to add</span>, <span class="text-yellow-400">1 to change</span>, <span class="text-red-400">1 to destroy</span>

<span class="text-gray-500">Do you want to perform these actions? Enter 'yes' or 'no':</span></pre>`;
                                terraformMode.active = true;
                            } else if (tfCmd === 'apply') {
                                output.innerHTML += `<div class="text-red-400 text-xs">Error: terraform apply requires --auto-approve-yolo flag in production</div>`;
                            } else if (tfCmd === 'destroy') {
                                output.innerHTML += `<div class="text-red-400 text-xs">Error: Nice try. Destruction requires physical presence in data center.</div>`;
                            } else {
                                output.innerHTML += `<div class="text-gray-500 text-xs">Usage: terraform [plan|apply|destroy]</div>`;
                            }
                            output.scrollTop = output.scrollHeight;
                            break;
                        case 'pietro':
                            // Secret easter egg - personal neofetch
                            const pietroLogo = `
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
 â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
 â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
 â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
 â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•`;
                            const pietroInfo = `
<span class="text-purple-400 font-bold">pietro@life</span>
<span class="text-gray-500">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="text-her-red">Role</span>: Infrastructure Engineer
<span class="text-her-red">Location</span>: Barcelona, Spain, Planet Earth ðŸŒ
<span class="text-her-red">Uptime</span>: ${(() => { const dob = new Date(1993, 5, 13, 1, 0, 0); const now = new Date(); let years = now.getFullYear() - dob.getFullYear(); const monthDiff = now.getMonth() - dob.getMonth(); if (monthDiff < 0 || (monthDiff === 0 && now.getDate() < dob.getDate())) years--; const lastBday = new Date(now.getFullYear(), 5, 13, 1, 0, 0); if (now < lastBday) lastBday.setFullYear(lastBday.getFullYear() - 1); const daysDiff = Math.floor((now - lastBday) / (1000 * 60 * 60 * 24)); const hours = now.getHours(); const mins = now.getMinutes(); return years + ' years, ' + daysDiff + ' days, ' + hours + 'h ' + mins + 'm'; })()}
<span class="text-her-red">Languages</span>: Spanish, English, Italian
<span class="text-her-red">Coffee</span>: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
<span class="text-her-red">Sleep</span>: â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 12%
<span class="text-gray-500">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="text-gray-400 italic">"Take a gamble that love exists, and do a loving act."</span>
<span class="text-gray-400 italic">- Sister CalderÃ³n</span>`;
                            output.innerHTML += `<div class="flex gap-4 my-2 font-mono text-xs">
    <pre class="text-purple-400 hidden sm:block">${pietroLogo}</pre>
    <pre>${pietroInfo}</pre>
</div>`;
                            output.scrollTop = output.scrollHeight;
                            break;
                        default:
                            if (cmd) output.innerHTML += `<div class="text-red-400">Command not found: ${cmd}</div>`;
                    }

                    inputEl.value = '';
                    output.scrollTop = output.scrollHeight;
                }
            }

            window.renderVault = function (filter = '') {
                const grid = document.getElementById('vault-grid');
                if (!grid) return;
                grid.innerHTML = '';

                const term = filter.toLowerCase();
                const activeCategory = document.querySelector('.vault-tab.active')?.innerText.toUpperCase();

                vaultData.forEach(item => {
                    // Filter Logic
                    if (activeCategory && activeCategory !== 'ALL' && item.category.toUpperCase() !== activeCategory) return;
                    if (term && !item.title.toLowerCase().includes(term) && !item.desc.toLowerCase().includes(term)) return;

                    // Render Card
                    const card = document.createElement('div');
                    card.className = "p-4 border border-her-text/10 rounded-lg bg-white/60 dark:bg-white/5 hover:border-her-orange/50 transition-all cursor-pointer group h-36 vault-card-animate";
                    card.style.animationDelay = `${grid.children.length * 50}ms`;
                    if (item.action) card.setAttribute('onclick', item.action);

                    // Icon based on type - Custom Icons for variety
                    let icon = '';
                    switch (item.type) {
                        case 'doc':
                            icon = '<svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>';
                            break;
                        case 'food':
                            icon = '<svg class="w-6 h-6 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"></path></svg>'; // Utensils/Abstract
                            break;
                        case 'music':
                            icon = '<svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg>';
                            break;
                        case 'book':
                            icon = '<svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>';
                            break;
                        case 'game':
                            icon = '<svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path></svg>';
                            break;
                        case 'app':
                            icon = '<svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>';
                            break;
                        case 'video':
                            icon = '<svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                            break;
                        case 'link':
                            icon = '<svg class="w-6 h-6 text-cyan-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>';
                            break;
                        case 'location':
                            icon = '<svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>';
                            break;
                        default:
                            icon = '<svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>';
                    }

                    card.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        ${icon}
                        ${item.status === 'soon' ? '<span class="px-2 py-0.5 text-[10px] font-bold bg-yellow-100 text-yellow-800 rounded">Soon</span>' : ''}
                    </div>
                    <div class="font-bold text-sm mb-1 group-hover:text-her-red transition-colors">${item.title}</div>
                    <div class="text-xs opacity-60 mb-3 line-clamp-2">${item.desc}</div>
                    <div class="flex items-center gap-2">
                        <span class="px-2 py-1 bg-black/5 dark:bg-white/10 rounded text-[10px] uppercase font-bold opacity-50">${item.category}</span>
                        ${item.status === 'ready' ? '<svg class="w-3 h-3 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>' : ''}
                    </div>
                `;
                    grid.appendChild(card);
                });
            }

            // --- Vault Navigation Functions ---
            window.vaultShowGrid = function() {
                const grid = document.getElementById('vault-grid');
                const content = document.getElementById('vault-content');
                const backBtn = document.getElementById('vault-back-btn');
                const filters = document.getElementById('vault-filters');
                const search = document.getElementById('vault-search');
                const title = document.getElementById('vault-title');
                
                if (!grid || !content) return;
                
                // Show grid, hide content
                grid.classList.remove('hidden');
                content.classList.add('hidden');
                backBtn.classList.add('hidden');
                filters.classList.remove('hidden');
                search.classList.remove('hidden');
                
                // Reset title
                title.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                    <span class="hidden md:inline">Personal Vault</span>
                    <span class="md:hidden">Vault</span>
                `;
            }

            window.vaultShowFile = async function(filePath, fileName) {
                const grid = document.getElementById('vault-grid');
                const content = document.getElementById('vault-content');
                const backBtn = document.getElementById('vault-back-btn');
                const filters = document.getElementById('vault-filters');
                const search = document.getElementById('vault-search');
                const title = document.getElementById('vault-title');
                const article = content.querySelector('.markdown-body');
                
                if (!grid || !content || !article) return;
                
                // Show loading state
                article.innerHTML = '<div class="text-center p-8 opacity-50">Loading...</div>';
                
                // Hide grid, show content
                grid.classList.add('hidden');
                content.classList.remove('hidden');
                backBtn.classList.remove('hidden');
                filters.classList.add('hidden');
                search.classList.add('hidden');
                
                // Update title to filename
                title.innerHTML = `<span>${fileName}</span>`;
                
                // Fetch and parse markdown
                try {
                    const response = await fetch(filePath);
                    if (!response.ok) throw new Error('File not found');
                    const markdown = await response.text();
                    article.innerHTML = marked.parse(markdown);
                } catch (error) {
                    const isLocalFile = window.location.protocol === 'file:';
                    if (isLocalFile) {
                        article.innerHTML = `
                            <div class="text-center p-8">
                                <div class="text-4xl mb-4">ðŸ“</div>
                                <h3 class="text-lg font-bold mb-2">Local Server Required</h3>
                                <p class="text-sm opacity-70 mb-4">Markdown files can't be loaded directly from the file system.<br>Please run a local server or deploy to S3.</p>
                                <code class="text-xs bg-black/10 dark:bg-white/10 px-3 py-2 rounded block">npx serve .</code>
                            </div>
                        `;
                    } else {
                        article.innerHTML = `<div class="text-red-500 p-4">Error loading file: ${error.message}</div>`;
                    }
                }
            }

            // --- Vault Filter Function ---
            window.filterVault = function(category) {
                // Update active tab styling
                const tabs = document.querySelectorAll('.vault-tab');
                tabs.forEach(tab => {
                    if (tab.innerText.toUpperCase() === category.toUpperCase()) {
                        tab.classList.add('active', 'bg-her-red', 'text-white');
                        tab.classList.remove('opacity-70');
                    } else {
                        tab.classList.remove('active', 'bg-her-red', 'text-white');
                        tab.classList.add('opacity-70');
                    }
                });
                
                // Re-render the vault with the new filter
                window.renderVault('');
            }

            // --- Fake Monitor Logic ---
            window.switchMonitorTab = function (tab) {
                document.getElementById('mon-view-infra').style.display = 'none';
                document.getElementById('mon-view-cloudfront').style.display = 'none';
                document.getElementById('mon-view-billing').style.display = 'none';

                // Layout logic: Infra is default (block/space-y), Cloudfront block, Billing flex (center)
                if (tab === 'infra') document.getElementById('mon-view-infra').style.display = 'block';
                else if (tab === 'cf') document.getElementById('mon-view-cloudfront').style.display = 'block';
                else if (tab === 'bill') document.getElementById('mon-view-billing').style.display = 'flex';

                // Tab styling
                ['infra', 'cf', 'bill'].forEach(t => {
                    const el = document.getElementById(`tab-${t}`);
                    if (t === tab) {
                        el.classList.add('border-her-red', 'text-her-red', 'bg-white/50', 'dark:bg-black/20');
                        el.classList.remove('border-transparent', 'opacity-60');
                    } else {
                        el.classList.remove('border-her-red', 'text-her-red', 'bg-white/50', 'dark:bg-black/20');
                        el.classList.add('border-transparent', 'opacity-60');
                    }
                });
            }

            function startMonitor() {
                if (monitorInterval) clearInterval(monitorInterval);

                // Canvas Setup
                const canvas = document.getElementById('monitor-canvas');
                const ctx = canvas.getContext('2d');
                let dataPoints = new Array(50).fill(20);
                let errorPoints = new Array(50).fill(5); // Error rate series

                // KPI Simulation
                const kpiReq = document.getElementById('kpi-req');
                const kpiData = document.getElementById('kpi-data');
                const logContainer = document.getElementById('sys-log');

                const logs = [
                    "[INFO] Auto-scaling group: +1 instance",
                    "[INFO] Route53 health check: Healthy",
                    "[WARN] High latency detected in ap-south-1",
                    "[INFO] S3 Lifecycle rule executed",
                    "[INFO] CloudFront cache refresh"
                ];

                monitorInterval = setInterval(() => {
                    // Update Graph Data
                    dataPoints.shift();
                    errorPoints.shift();
                    const base = 40 + Math.random() * 30;
                    dataPoints.push(base);
                    errorPoints.push(Math.max(0, 5 + (Math.random() * 10 - 5))); // Sim error

                    // Render Graph
                    // Check visibility to save resources
                    if (canvas && canvas.offsetParent !== null) {
                        // Resize if needed
                        if (canvas.width !== canvas.clientWidth) {
                            canvas.width = canvas.clientWidth;
                            canvas.height = canvas.clientHeight;
                        }
                        const w = canvas.width;
                        const h = canvas.height;

                        ctx.clearRect(0, 0, w, h);

                        // Draw Main Traffic
                        ctx.beginPath();
                        ctx.moveTo(0, h);
                        dataPoints.forEach((p, i) => {
                            const x = (i / (dataPoints.length - 1)) * w;
                            const y = h - (p / 100) * h;
                            ctx.lineTo(x, y);
                        });
                        ctx.lineTo(w, h);
                        ctx.fillStyle = 'rgba(74, 124, 157, 0.2)'; // Blue tint #4A7C9D
                        ctx.fill();

                        // Stroke Main
                        ctx.beginPath();
                        dataPoints.forEach((p, i) => {
                            const x = (i / (dataPoints.length - 1)) * w;
                            const y = h - (p / 100) * h;
                            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                        });
                        ctx.strokeStyle = '#4A7C9D'; // Blue
                        ctx.lineWidth = 2;
                        ctx.stroke();

                        // Draw Error Rate (Dashed)
                        ctx.beginPath();
                        ctx.setLineDash([5, 5]);
                        errorPoints.forEach((p, i) => {
                            const x = (i / (errorPoints.length - 1)) * w;
                            const y = h - (p / 100) * h; // Scale differently realistically, but for viz ok
                            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                        });
                        ctx.strokeStyle = '#4A7C9D';
                        ctx.lineWidth = 1;
                        ctx.stroke();
                        ctx.setLineDash([]);
                    }

                    // Update KPIs
                    if (kpiReq && Math.random() > 0.7) kpiReq.innerText = (2.4 + Math.random() * 0.2).toFixed(1) + 'k';
                    if (logContainer && Math.random() > 0.9) {
                        const log = logs[Math.floor(Math.random() * logs.length)];
                        const div = document.createElement('div');
                        div.innerText = log;
                        logContainer.prepend(div);
                        if (logContainer.children.length > 5) logContainer.lastChild.remove();
                    }

                }, 1000);
            }

            // Initial site Launch
            setTimeout(() => {
                window.openWindow('about');
            }, 100);

        });
    </script>
</body>

</html>