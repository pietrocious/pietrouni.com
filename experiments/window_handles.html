<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=overlays-content">
    <title>Window Resizer Experiments | OS93</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        ui: ['"Noto Sans"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    colors: {
                        her: {
                            red: "#4A7C9D",
                            dark: "#3E2723",
                            text: "#4E342E",
                            textLight: "#EFEBE9"
                        }
                    }
                }
            }
        }
    </script>
    
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="window_handles.css">
    
    <style>
        /* Overrides for experiment visibility */
        body {
            background-color: #1a1412;
            color: white;
            font-family: 'Noto Sans', sans-serif;
            overflow: hidden;
        }
        
        .label-tag {
            position: absolute;
            top: -30px;
            left: 0;
            background: #4A7C9D;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            white-space: nowrap;
        }
    </style>
</head>

<body class="h-screen w-screen relative overflow-hidden">

    <!-- Instructions -->
    <div class="absolute top-4 left-4 z-50 bg-black/50 p-4 rounded-lg backdrop-blur-sm pointer-events-none">
        <h1 class="text-xl font-bold mb-2">Window Handle Experiments</h1>
        <p class="text-sm opacity-80 mb-2">Test the different resize handle styles below.</p>
        <ul class="text-xs list-disc pl-4 opacity-70">
            <li>Style 1: Invisible (Current Behavior)</li>
            <li>Style 2: Corner Grip (Classic)</li>
            <li>Style 3: Visual Border (On Hover)</li>
            <li>Style 4: Pill/Bar (Mobile Modern)</li>
        </ul>
    </div>

    <!-- Windows Container -->
    <div id="windows-container" class="absolute inset-0 pointer-events-auto">
        <!-- Windows injected by JS -->
    </div>

    <script>
        const styles = [
            { id: 'invisible', name: 'Original (Invisible)', class: 'window-resize-invisible', x: 50, y: 100 },
            { id: 'grip', name: 'Classic Grip', class: 'window-resize-grip', x: 400, y: 100 },
            { id: 'border', name: 'Border Highlight', class: 'window-resize-border', x: 50, y: 400 },
            { id: 'pill', name: 'Modern Pill', class: 'window-resize-pill', x: 400, y: 400 }
        ];

        // --- Window Management Logic (Simplified from index.html) ---
        let zIndexCounter = 100;
        let activeWindows = {};

        function initWindows() {
            styles.forEach(style => {
                createWindow(style);
            });
        }

        function createWindow(config) {
            const winEl = document.createElement('div');
            winEl.className = `window absolute flex flex-col active-window ${config.class}`;
            winEl.id = `win-${config.id}`;
            winEl.style.width = '300px';
            winEl.style.height = '200px';
            winEl.style.left = `${config.x}px`;
            winEl.style.top = `${config.y}px`;
            winEl.style.zIndex = ++zIndexCounter;

            winEl.innerHTML = `
                <div class="label-tag">${config.name}</div>
                <div class="window-header" onmousedown="startDrag(event, '${config.id}')">
                    <div class="controls-neon-flat">
                        <button class="btn-neon close"></button>
                        <button class="btn-neon min"></button>
                        <button class="btn-neon max"></button>
                    </div>
                    <span class="window-title">${config.name}</span>
                </div>
                <div class="flex-1 p-4 bg-white/5 overflow-hidden text-xs opacity-60">
                    <p>Try resizing this window from any edge or corner.</p>
                    <p class="mt-2">Drag me around!</p>
                </div>
            `;

            winEl.onmousemove = (e) => updateWindowCursor(e, winEl);
            winEl.onmousedown = (e) => {
                bringToFront(config.id);
                handleResizeStart(e, winEl, config.id);
            };

            document.getElementById('windows-container').appendChild(winEl);
            activeWindows[config.id] = { element: winEl };
        }

        function bringToFront(id) {
            activeWindows[id].element.style.zIndex = ++zIndexCounter;
            document.querySelectorAll('.window').forEach(w => w.classList.remove('active-window'));
            activeWindows[id].element.classList.add('active-window');
        }

        // --- Drag Logic ---
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let dragId = null;

        window.startDrag = function (e, id) {
            const win = activeWindows[id].element;
            const rect = win.getBoundingClientRect();
            
            // Check if near top edge (resize zone)
            if (e.clientY - rect.top < 10) return;

            isDragging = true;
            dragId = id;
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            win.classList.add('dragging');
            bringToFront(id);
        }

        window.addEventListener('mousemove', (e) => {
            if (isDragging && dragId) {
                e.preventDefault();
                const win = activeWindows[dragId].element;
                win.style.left = `${e.clientX - dragOffset.x}px`;
                win.style.top = `${e.clientY - dragOffset.y}px`;
            }
        });

        window.addEventListener('mouseup', () => {
            if (isDragging && dragId) {
                activeWindows[dragId].element.classList.remove('dragging');
            }
            isDragging = false;
            dragId = null;
        });

        // --- Resize Logic ---
        let resizeDir = null;
        let isResizing = false;
        let resizeWin = null;
        let startResizeRect = null;
        let startResizePos = null;

        function updateWindowCursor(e, win) {
            if (isResizing) return;
            const rect = win.getBoundingClientRect();
            const border = 10;
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            let cursor = '';
            if (y < border && x < border) cursor = 'nw-resize';
            else if (y < border && x > rect.width - border) cursor = 'ne-resize';
            else if (y > rect.height - border && x < border) cursor = 'sw-resize';
            else if (y > rect.height - border && x > rect.width - border) cursor = 'se-resize';
            else if (y < border) cursor = 'n-resize';
            else if (y > rect.height - border) cursor = 's-resize';
            else if (x < border) cursor = 'w-resize';
            else if (x > rect.width - border) cursor = 'e-resize';

            win.style.cursor = cursor || 'default';
        }

        function getResizeDir(e, win) {
            const rect = win.getBoundingClientRect();
            const border = 10;
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            let dir = '';
            if (y < border) dir += 'n';
            if (y > rect.height - border) dir += 's';
            if (x < border) dir += 'w';
            if (x > rect.width - border) dir += 'e';
            return dir;
        }

        function handleResizeStart(e, win, id) {
            const dir = getResizeDir(e, win);
            if (!dir) return;

            e.preventDefault();
            isResizing = true;
            resizeWin = win;
            resizeDir = dir;
            win.classList.add('resizing');
            
            // Add 'can-resize' class for Style 3 to show border
            win.classList.add('can-resize');

            startResizeRect = {
                left: win.offsetLeft,
                top: win.offsetTop,
                width: win.offsetWidth,
                height: win.offsetHeight
            };
            startResizePos = { x: e.clientX, y: e.clientY };
        }

        window.addEventListener('mousemove', (e) => {
            if (!isResizing || !resizeWin) return;

            const dx = e.clientX - startResizePos.x;
            const dy = e.clientY - startResizePos.y;
            const rect = startResizeRect;
            const minW = 200;
            const minH = 150;

            if (resizeDir.includes('e')) resizeWin.style.width = `${Math.max(minW, rect.width + dx)}px`;
            if (resizeDir.includes('s')) resizeWin.style.height = `${Math.max(minH, rect.height + dy)}px`;
            if (resizeDir.includes('w')) {
                const newW = Math.max(minW, rect.width - dx);
                resizeWin.style.width = `${newW}px`;
                resizeWin.style.left = `${rect.left + (rect.width - newW)}px`;
            }
            if (resizeDir.includes('n')) {
                const newH = Math.max(minH, rect.height - dy);
                resizeWin.style.height = `${newH}px`;
                resizeWin.style.top = `${rect.top + (rect.height - newH)}px`;
            }
        });

        window.addEventListener('mouseup', () => {
            if (isResizing && resizeWin) {
                resizeWin.classList.remove('resizing');
                resizeWin.classList.remove('can-resize');
            }
            isResizing = false;
            resizeWin = null;
        });

        // Start
        window.addEventListener('DOMContentLoaded', initWindows);
    </script>
</body>
</html>
